class DD_EventHandler : EventHandler
{
	const SKILL_VERY_EASY = 0;
	const SKILL_EASY = 1;
	const SKILL_NORMAL = 2;
	const SKILL_HARD = 3;
	const SKILL_VERY_HARD = 4;
	const SKILL_EXTREME = 5;
	const SKILL_HORRIBLE = 6;
	const SKILL_IMPOSSIBLE = 7;
	const SKILL_OMEGA = 8;

	override void WorldTick()
	{
	}

	override void NewGame()
	{
		let globalvars = DDGlobalVariables.Get();
		if (globalvars.MapsFinished == 0) globalvars.MapsFinished = -1;
		if (dydudebug_mapfinishcheck) Console.Printf("\c[gold]NewGame() (DD_EventHandler) [%d]", globalvars.MapsFinished);
		Super.NewGame();
	}
	
	void ProjSetSpeed(actor spawnee)
	{
		double spdfactor, oldspdfactor;
		
		if (Level.MapName != "TITLEMAP")
		{
			if (!spawnee.accuracy)
			{
				if (spawnee)
				{
					if (MiniNote(spawnee))
					{
					}
					else
					{
						if (spawnee.target)
						{
							if (spawnee.target.bISMONSTER && !PlayerPawn(spawnee.target) && spawnee.target.default.speed != 0)
							{
								spdfactor = spawnee.target.speed / spawnee.target.default.speed;
								oldspdfactor = spdfactor;
								if (spdfactor >= 1.00) 
								{
									spdfactor -= 1.00;
									if (skill <= 0) spdfactor *= 0.25;
									if (skill == 1) spdfactor *= 0.375;
									if (skill == 2) spdfactor *= 0.5;
									if (skill == 3) spdfactor *= 0.625;
									if (skill >= 4) spdfactor *= 0.75;
									spdfactor *= frandom(0.875,1.125);
									spdfactor *= exex_mprojectilevelmulti;
									if (spdfactor < 0.00) spdfactor = 0.00;
									spdfactor += 1.00;
									spawnee.A_ScaleVelocity(spdfactor);
								}
								if (dydudebug_projectilespawns) Console.Printf("(%s) spdfactor: %.8f (%.8f), spawnee.target.speed: %.8f, spawnee.target.default.speed: %.8f", spawnee.GetClassName(), spdfactor, oldspdfactor, spawnee.target.speed, spawnee.target.default.speed);
							}
						}
					}
					spawnee.accuracy++;
				}
			}
		}
	}
	
	void MonsterStatsSet(actor spawnee, int basemonsterrating, bool practicetarget, bool specialenemy, bool ispeasant)
	{
		if (Level.MapName != "TITLEMAP")
		{
			let globalvars = DDGlobalVariables.Get();
			actor player = players[0].mo;
			let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
			int TruePlayerLevel = 0;
			if (exex_expenabled && MiscItem) TruePlayerLevel = MiscItem.PlayerLevel;
			string spawnname = spawnee.GetClassName();
			
			double hpmulti, atkmulti, defmulti, spdmulti, massmulti;
			double hpmulti2, atkmulti2, defmulti2, spdmulti2, massmulti2;
			// Monster "Scaling"
			if (spawnee.bISMONSTER && !practicetarget)
			{
				if (dydudebug_monsterscaling) Console.Printf("\c[gold][MonsterStatsSet], tic: %d, actor: %p [%s]\c-", gametic, spawnee, spawnee.GetClassName());
				int LevelErrorRange;
				int LevelCheck;
				int LevelChecker = 1;
				int MapDifficultyInflation = clamp(exex_mapdifficultyinflation, -2000, 2000);
				int MapDifficultyInflationPercent = clamp(exex_mapdifficultyinflation2,  1, 5000);
				int MapErrorRange;
				int LevelDifficultyInflation = clamp(exex_leveldifficultyinflation, -2000, 2000);
				int LevelDifficultyInflationPercent = clamp(exex_leveldifficultyinflation2, -100, 2000);
				int MapCheck;
				double monsterrating = 0;
				double monsterlevel = 0;
				double leveltemp = 0;
				double luckmult = 0;
				double origSpd = spawnee.Speed;
				double origDmgMul = spawnee.DamageMultiply;
				double origDmgFct = spawnee.DamageFactor;
				double origHealth = spawnee.health;
				double origMass = spawnee.Mass;
				EECreature EEC;
				EEC = EECreature(spawnee);
			
				hpmulti = 0.00;
				atkmulti = 0.00;
				defmulti = 0.00;
				spdmulti = 0.00;
				massmulti = 0.00;
				if (!specialenemy || !ispeasant)
				{
					double mult;
					double mult2;
					double multbase = 1;
					int basedivfactor = 16;
					if (skill <= 0) basedivfactor = 22;
					if (skill == 1) basedivfactor = 19;
					if (skill == 2) basedivfactor = 16;
					if (skill == 3) basedivfactor = 11;
					if (skill >= 4) basedivfactor = 6;
					
					if (random(1,basedivfactor) <= 8)
					{
						if (random(1,basedivfactor) <= 4)
						{
							if (random(1,basedivfactor) <= 2)
							{
								if (random(1,basedivfactor) <= 1)
								{
									if (random(1,basedivfactor) <= 1)
									{
										if (random(1,basedivfactor) <= 1)
										{
											if (random(1,basedivfactor) <= 1)
											{
												if (random(1,basedivfactor) <= 1) monsterrating = 8;
												else monsterrating = 7;
											}
											else monsterrating = 6;
										}
										else monsterrating = 5;
									}
									else monsterrating = 4;
								}
								else monsterrating = 3;
							}
							else monsterrating = 2;
						}
						else monsterrating = 1;
					}
					
					if (monsterrating < basemonsterrating) monsterrating = basemonsterrating;
					multbase = 1.0;
					double baseadd = 0.0;
					if (monsterrating == 1) baseadd = 0.5; // [E]
					if (monsterrating == 2) baseadd = 1.125; // [D]
					if (monsterrating == 3) baseadd = 2.2; // [C]
					if (monsterrating == 4) baseadd = 3.25; // [B]
					if (monsterrating == 5) baseadd = 4.334; // [A]
					if (monsterrating == 6) baseadd = 5.4; // [S]
					if (monsterrating == 7) baseadd = 6.5; // <SS>
					if (monsterrating >= 8) baseadd = 7.75; // <SSS>
					baseadd *= 0.5;
					multbase += baseadd;
			
					if (DDOrigCreature(spawnee)) 
					{
						double baseextra = frandompick(0.25,0.5,1.25,1.25,2,2.25);
						baseextra *= 0.5;
						baseextra += 1.0;
						if (DDOrigBoss(spawnee)) baseextra *= 1.5;
						multbase *= baseextra;
					}
					
					if (random(1,32) <= (1 + (monsterrating * 1)))
					{
						multbase *= 2;
						if (random(1,32) <= (1 + (monsterrating * 0.667))) multbase *= 2;
					}
					
					//***********************
					//* PlayerLevel Scaling *
					//***********************
					if (exex_enemyscalingplevel && globalvars && MiscItem)
					{
						LevelCheck += MiscItem.TruePlayerLevel;
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [PlayerLevel Check]: %d (PlayLvl: +%d)", LevelCheck, MiscItem.TruePlayerLevel);

						if (EEC)
						{
							LevelCheck += EEC.user_ressurrectstr; // Checks the "Resurrect" strength of a monster [Clay Devils in TCOTD:A get stronger each time they resurrect]
							if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [ResurrectStr Check]: %d (ResStr: +%d)", LevelCheck, EEC.user_ressurrectstr);
						}
						
						LevelCheck += LevelDifficultyInflation;
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [inflation-exact]: %d (Difficulty Inflation: +%d)", LevelCheck, LevelDifficultyInflation);
			
						LevelCheck = LevelCheck * (100 + LevelDifficultyInflationPercent) / 100;
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [inflation-percent]: %d (Percent: %d%)", LevelCheck, (100 + LevelDifficultyInflationPercent));
						
						LevelErrorRange = LevelCheck * 0.1667;
						if (LevelErrorRange < 1) LevelErrorRange = random(0,3);
						LevelCheck += random(-LevelErrorRange,LevelErrorRange);
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [error-range]: %d (Error Range: +-%d)", LevelCheck, LevelErrorRange);

						int PreviousLevelCheck = LevelCheck;

						// Specific Monsters
						if (SpiderMastermind(spawnee) || SpiderMastermindNew(spawnee)) LevelCheck += random(3,6);
						if (Cyberdemon(spawnee) || CyberdemonNew(spawnee)) LevelCheck += random(3,6);
						if (Annihilator(spawnee) || Demolisher(spawnee)) LevelCheck += random(3,6);
						if (Minotaur(spawnee) || MinotaurFriend(spawnee)) LevelCheck += random(3,6);

						// Specific Bosses
						// Tier 1 Boss
						if (Sorcerer1(spawnee) || Sorcerer1New(spawnee)) LevelCheck += random(9,18);
						if (FighterBoss(spawnee)) LevelCheck += random(9,18);
						if (ClericBoss(spawnee)) LevelCheck += random(9,18);
						if (MageBoss(spawnee)) LevelCheck += random(9,18);
						// Tier 2 Boss
						if (Sorcerer2(spawnee) || Sorcerer2New(spawnee)) LevelCheck += random(15,30);
						if (Korax(spawnee) || KoraxNew(spawnee)) LevelCheck += random(15,30);
						if (spawnname == "ThamuzNew" || spawnname == "TchernobogNew") LevelCheck += random(15,30);
						// Tier 3 Boss
						if (spawnname == "PennywiseBoss" || spawnname == "TchernobogNew") LevelCheck += random(23,45);
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [actor-check: %s]: %d (Previous: %d)", spawnname, LevelCheck, PreviousLevelCheck);
						
						PreviousLevelCheck = LevelCheck;
						LevelCheck = clamp(LevelCheck, 0, 2000);
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [final calc]: %d (Previous: %d)", LevelCheck, PreviousLevelCheck);
						spawnee.A_SetInventory("MonsterLevel",LevelCheck);
						EECreature spawnee2;
						spawnee2 = EECreature(spawnee);
						if (spawnee2 && spawnee2.user_levelpreset) spawnee2.A_SetInventory("MonsterLevel",spawnee2.user_levelpreset);
						//
						double truemultbase = multbase *= exex_enemyscalelevelmultiplier;
						if (spawnee.bFRIENDLY)
						{
							if (skill <= 0) mult = 0.00275;
							if (skill == 1) mult = 0.002625;
							if (skill == 2) mult = 0.0025;
							if (skill == 3) mult = 0.002375;
							if (skill >= 4) mult = 0.00225;
						}
						else
						{
							if (skill <= 0) mult = 0.00225;
							if (skill == 1) mult = 0.002375;
							if (skill == 2) mult = 0.0025;
							if (skill == 3) mult = 0.002625;
							if (skill >= 4) mult = 0.00275;
						}
						mult *= 0.9;
						mult *= (1.0 + (0.125 * monsterrating));
						mult *= truemultbase;

						// Attack
						double baseatkmulti = (LevelCheck * mult);
						if (LevelCheck >= 1 && LevelCheck <= 20) baseatkmulti *= frandom(1.0025,1.005);
						if (LevelCheck >= 21 && LevelCheck <= 40) baseatkmulti *= frandom(1.0075,1.015);
						if (LevelCheck >= 41 && LevelCheck <= 60) baseatkmulti *= frandom(1.015,1.03);
						if (LevelCheck >= 61 && LevelCheck <= 80) baseatkmulti *= frandom(1.025,1.05);
						if (LevelCheck >= 81 && LevelCheck <= 100) baseatkmulti *= frandom(1.0375,1.075);
						if (LevelCheck >= 101 && LevelCheck <= 120) baseatkmulti *= frandom(1.0525,1.105);
						if (LevelCheck >= 121 && LevelCheck <= 140) baseatkmulti *= frandom(1.07,1.14);
						if (LevelCheck >= 141 && LevelCheck <= 160) baseatkmulti *= frandom(1.09,1.18);
						if (LevelCheck >= 161 && LevelCheck <= 180) baseatkmulti *= frandom(1.1125,1.225);
						if (LevelCheck >= 181 && LevelCheck <= 199) baseatkmulti *= frandom(1.1375,1.275);
						if (LevelCheck >= 200) baseatkmulti *= frandom(1.165,1.33);
						atkmulti = baseatkmulti;
						//
						if (KilletanteSoloist(spawnee)) atkmulti *= 1.25;
						else if (Killetante(spawnee)) atkmulti *= 1.0625;
						else if (CoSForsaken(spawnee)) atkmulti *= 1.125;
						if (dydudebug_monsterscaling) Console.Printf("atkmulti: %.8f", atkmulti);
						
						// Defense
						defmulti = 1.0 / (baseatkmulti + 1.0);
						defmulti -= 1.0;
						if (dydudebug_monsterscaling) Console.Printf("defmulti: %.8f", defmulti);
						
						// Speed
						spdmulti = (baseatkmulti * 0.25);
						//
						if (KilletanteSoloist(spawnee)) spdmulti *= 1.125;
						else if (Killetante(spawnee)) spdmulti *= 1.0625;
						else if (CoSForsaken(spawnee)) spdmulti *= 1.125;
						if (dydudebug_monsterscaling) Console.Printf("spdmulti: %.8f", spdmulti);
							
						// Mass
						massmulti = (baseatkmulti / 1.25);
						if (dydudebug_monsterscaling) Console.Printf("massmulti: %.8f", massmulti);
						
						// Health
						hpmulti = (baseatkmulti / 1.25);
						if (dydudebug_monsterscaling) Console.Printf("hpmulti: %.8f", hpmulti);
					}
					
					//*********************
					//* Map-Based Scaling *
					//*********************
					if (exex_enemyscalingmaps && globalvars && MiscItem)
					{
						double truemultbase = multbase *= exex_enemyscalemapmultiplier;
						if (spawnee.bFRIENDLY)
						{
							if (skill <= 0) mult2 = 0.00275;
							if (skill == 1) mult2 = 0.002625;
							if (skill == 2) mult2 = 0.0025;
							if (skill == 3) mult2 = 0.002375;
							if (skill >= 4) mult2 = 0.00225;
						}
						else
						{
							if (skill <= 0) mult2 = 0.00225;
							if (skill == 1) mult2 = 0.002375;
							if (skill == 2) mult2 = 0.0025;
							if (skill == 3) mult2 = 0.002625;
							if (skill >= 4) mult2 = 0.00275;
						}
						mult2 *= (random(2,4) * 0.9);
						mult2 *= (1.0 + ((random(5,10) * 0.0125) * monsterrating));
						mult2 *= truemultbase;
						
						MapCheck = globalvars.MapsFinished;
						
						MapCheck += MapDifficultyInflation;
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [inflation-exact]: %d (Difficulty Inflation: +%d)", MapCheck, MapDifficultyInflation);
			
						MapCheck = MapCheck * (100 + MapDifficultyInflationPercent) / 100;
						if (dydudebug_monsterscaling) Console.Printf("\ckMonsterLevel [inflation-percent]: %d (Percent: %d%)", MapCheck, (100 + MapDifficultyInflationPercent));

						// Attack
						double baseatkmulti2 = (MapCheck * mult2);
						if (MapCheck >= 1 && MapCheck <= 6) baseatkmulti2 *= 1.0125;
						if (MapCheck >= 7 && MapCheck <= 11) baseatkmulti2 *= 1.025;
						if (MapCheck >= 12 && MapCheck <= 20) baseatkmulti2 *= 1.0375;
						if (MapCheck >= 21 && MapCheck <= 30) baseatkmulti2 *= 1.05;
						if (MapCheck >= 31 && MapCheck <= 40) baseatkmulti2 *= 1.0625;
						if (MapCheck >= 41 && MapCheck <= 50) baseatkmulti2 *= 1.075;
						if (MapCheck >= 51 && MapCheck <= 60) baseatkmulti2 *= 1.0875;
						if (MapCheck >= 61 && MapCheck <= 70) baseatkmulti2 *= 1.10;
						if (MapCheck >= 71 && MapCheck <= 80) baseatkmulti2 *= 1.125;
						if (MapCheck >= 81 && MapCheck <= 90) baseatkmulti2 *= 1.25;
						if (MapCheck >= 91 && MapCheck <= 100) baseatkmulti2 *= 1.375;
						if (MapCheck >= 101 && MapCheck <= 125) baseatkmulti2 *= 1.5;
						if (MapCheck >= 126 && MapCheck <= 150) baseatkmulti2 *= 1.625;
						if (MapCheck >= 151 && MapCheck <= 175) baseatkmulti2 *= 1.75;
						if (MapCheck >= 176 && MapCheck <= 200) baseatkmulti2 *= 1.875;
						if (MapCheck >= 201) baseatkmulti2 *= 2.0;
						atkmulti2 = baseatkmulti2;
						//
						if (KilletanteSoloist(spawnee)) atkmulti2 *= 1.25;
						else if (Killetante(spawnee)) atkmulti2 *= 1.0625;
						else if (CoSForsaken(spawnee)) atkmulti2 *= 1.125;
						if (dydudebug_monsterscaling) Console.Printf("atkmulti2: %.8f", atkmulti2);
						
						// Defense
						defmulti2 = 1.0 / (atkmulti2 + 1.0);
						defmulti2 -= 1.0;
						if (dydudebug_monsterscaling) Console.Printf("defmulti2: %.8f", defmulti2);
						
						// Speed
						spdmulti2 = (atkmulti2 * 0.3125);
						if (KilletanteSoloist(spawnee)) spdmulti2 *= 1.125;
						else if (Killetante(spawnee)) spdmulti2 *= 1.0625;
						if (dydudebug_monsterscaling) Console.Printf("spdmulti2: %.8f", spdmulti2);
							
						// Mass
						massmulti2 = atkmulti2 * 0.667;
						if (dydudebug_monsterscaling) Console.Printf("massmulti2: %.8f", massmulti2);
						
						// Health
						hpmulti2 = atkmulti2 * 0.667;
						if (dydudebug_monsterscaling) Console.Printf("hpmulti2: %.8f", hpmulti2);
					}
			
					// Final Calcs
					double tempfinmulti = 1.0;
					if (spdmulti || spdmulti2) 
					{
						tempfinmulti = 1.0;
						double SpeedErrorRange = (spdmulti * 0.125);
						spdmulti += frandom(-SpeedErrorRange,SpeedErrorRange);
						tempfinmulti *= (1.0 + spdmulti);

						SpeedErrorRange = (spdmulti2 * 0.0625);
						spdmulti2 += frandom(-SpeedErrorRange,SpeedErrorRange);
						tempfinmulti *= (1.0 + spdmulti2);

						double maxtempfin = 3.34 + (monsterrating * (1.25 * 0.334));
						if (tempfinmulti > maxtempfin) tempfinmulti = maxtempfin;
						spawnee.Speed *= tempfinmulti;
						
						if (dydudebug_monsterscaling) Console.Printf("\c[lightblue]Speed: %.8f [old: %.8f, multi: %.8f, multi2: %.8f]\c-", spawnee.Speed, origSpd, spdmulti, spdmulti2);
					}
					if (atkmulti || atkmulti2) 
					{
						tempfinmulti = 1.0;
						double AttackErrorRange = (atkmulti * 0.125);
						atkmulti += frandom(-AttackErrorRange,AttackErrorRange);
						tempfinmulti *= (1.0 + atkmulti);

						AttackErrorRange = (atkmulti2 * 0.0625);
						atkmulti2 += frandom(-AttackErrorRange,AttackErrorRange);
						tempfinmulti *= (1.0 + atkmulti2);
						
						double maxtempfin = 10.0 + (monsterrating * 1.25);
						if (tempfinmulti > maxtempfin) tempfinmulti = maxtempfin;

						spawnee.DamageMultiply = tempfinmulti;
						if (dydudebug_monsterscaling) Console.Printf("\c[red]DamageMultiply: %.8f [old: %.8f, multi: %.8f, multi2: %.8f]\c-", spawnee.DamageMultiply, origDmgMul, atkmulti, atkmulti2);
					}
					if (defmulti || defmulti2) 
					{
						tempfinmulti = 1.0;
						double DefenseErrorRange = (defmulti * 0.125);
						defmulti += frandom(-DefenseErrorRange,DefenseErrorRange);
						tempfinmulti *= (1.0 + defmulti);

						DefenseErrorRange = (defmulti2 * 0.0625);
						defmulti2 += frandom(-DefenseErrorRange,DefenseErrorRange);
						tempfinmulti *= (1.0 + defmulti2);
						double maxtempfin = (0.1 - (monsterrating * 0.005));
						if (tempfinmulti < maxtempfin) maxtempfin = maxtempfin;

						spawnee.DamageFactor = tempfinmulti;
						if (dydudebug_monsterscaling) Console.Printf("\c[olive]DamageFactor: %.8f [old: %.8f, multi: %.8f, multi2: %.8f]\c-", spawnee.DamageFactor, origDmgFct, defmulti, defmulti2);
					}
					if (hpmulti || hpmulti2) 
					{
						tempfinmulti = 0;
						double MaxHPErrorRange = (hpmulti * 0.125);
						hpmulti += frandom(-MaxHPErrorRange,MaxHPErrorRange);
						tempfinmulti += hpmulti;

						MaxHPErrorRange = (hpmulti2 * 0.0625);
						hpmulti2 += frandom(-MaxHPErrorRange,MaxHPErrorRange);
						tempfinmulti += hpmulti2;

						double maxtempfin = 2.5 + (monsterrating * 0.25);
						if (tempfinmulti > maxtempfin) tempfinmulti = maxtempfin;
						if (tempfinmulti > (spawnee.SpawnHealth() * maxtempfin)) tempfinmulti = (spawnee.SpawnHealth() * maxtempfin);

						spawnee.health *= (1.0 + tempfinmulti);
						spawnee.Stamina = (spawnee.health - spawnee.SpawnHealth());
						if (dydudebug_monsterscaling) Console.Printf("\c[brick]Health: %d (stam: %d) [old: %d, diff: %d, diff2: %d]\c-", spawnee.health, spawnee.Stamina, origHealth, hpmulti, hpmulti2);
					}
					if (massmulti || massmulti2) 
					{
						tempfinmulti = 0;
						double MassErrorRange = (massmulti * 0.125);
						massmulti += frandom(-MassErrorRange,MassErrorRange);
						tempfinmulti += massmulti;

						MassErrorRange = (massmulti2 * 0.0625);
						massmulti2 += frandom(-MassErrorRange,MassErrorRange);
						tempfinmulti += massmulti2;

						double maxtempfin = 2.5 + (monsterrating * 0.25);
						if (tempfinmulti > maxtempfin) tempfinmulti = maxtempfin;
						if (tempfinmulti > (spawnee.default.mass * maxtempfin)) tempfinmulti = (spawnee.default.mass * maxtempfin);

						spawnee.mass *= (1.0 + tempfinmulti);
						spawnee.Accuracy = (spawnee.mass - spawnee.default.mass);
						if (dydudebug_monsterscaling) Console.Printf("\c[brown]Mass: %d (Acc: %d) [old: %d, diff: %d, diff2: %d]\c-", spawnee.Mass, spawnee.Accuracy, origMass, massmulti, massmulti2);
					}
				}
				
				if (LevelCheck)
				{
					if (random(1,100) <= random(11,13))
					{
						if (skill <= 0) LevelCheck *= frandompick(1.00,1.0078125,1.0078125,1.0078125,1.0078125,1.0078125,1.015625);
						if (skill == 1) LevelCheck *= frandompick(1.00,1.015625,1.015625,1.015625,1.015625,1.015625,1.03125);
						if (skill == 2) LevelCheck *= frandompick(1.00,1.03125,1.03125,1.03125,1.03125,1.03125,1.0625);
						if (skill == 3) LevelCheck *= frandompick(1.00,1.0625,1.0625,1.0625,1.0625,1.0625,1.125);
						if (skill >= 4) LevelCheck *= frandompick(1.00,1.125,1.125,1.125,1.125,1.125,1.25);
					}

					spawnee.A_SetInventory("MonsterLevel",LevelCheck);
					if (dydudebug_monsterscaling) Console.Printf("Actor's Level: %d [%d], Actor's Rating: %d [%d]", LevelCheck, spawnee.CountInv("MonsterLevel"), monsterrating, spawnee.CountInv("MonsterRating"));
				}
				string montag = spawnee.GetTag();
				montag.AppendFormat(" \c[gold](L%d)\c-", LevelCheck);
				spawnee.SetTag(montag);
				
				EECreature spawnee2;
				spawnee2 = EECreature(spawnee);
				if (spawnee2 && spawnee2.user_rankpreset) 
				{
					spawnee2.A_SetInventory("MonsterRating",spawnee2.user_rankpreset);
					monsterrating = spawnee2.CountInv("MonsterRating");
					monsterrating = spawnee2.user_rankpreset;
				}
				if (monsterrating)
				{
					spawnee.A_SetInventory("MonsterRating",monsterrating);
					string montag = spawnee.GetTag();
					if (monsterrating == 8) montag.AppendFormat(" \c[purple]<SSS>\c-");
					else if (monsterrating == 7) montag.AppendFormat(" \c[fire]<SS>\c-");
					else if (monsterrating == 6) montag.AppendFormat(" \c[red][S]\c-");
					else if (monsterrating == 5) montag.AppendFormat(" \c[brick][A]\c-");
					else if (monsterrating == 4) montag.AppendFormat(" \c[orange][B]\c-");
					else if (monsterrating == 3) montag.AppendFormat(" \c[yellow][C]\c-");
					else if (monsterrating == 2) montag.AppendFormat(" \c[green][D]\c-");
					else if (monsterrating == 1) montag.AppendFormat(" \c[sapphire][E]\c-");
					spawnee.SetTag(montag);
				}
				
				double levelmulfact = 1.5;
				if (exex_monsterlevelenabledflags)
				{
					if (monsterlevel >= (10 * levelmulfact))
					{
						if (HammerDuck(spawnee)) spawnee.bAVOIDMELEE = true;
						if (PlanterBird(spawnee)) spawnee.bAVOIDMELEE = true;
						if (CentaurionSgt(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Vitriola(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Muddernaut(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Jugger(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Juggette(spawnee)) spawnee.bAVOIDMELEE = true;
						if (ReelHeel(spawnee)) spawnee.bAVOIDMELEE = true;
						if (SpiderCenser(spawnee)) spawnee.bAVOIDMELEE = true;
					}
					
					if (monsterlevel >= (15 * levelmulfact))
					{
						if (SugarSnake(spawnee)) spawnee.bAVOIDMELEE = true;
						if (MiniSugarSnake(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (Cyberdemon(spawnee) || CyberdemonNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (SpiderMasterMind(spawnee) || SpiderMasterMindNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (UltraMastermind(spawnee)) spawnee.bAVOIDMELEE = true;
			
						if (Minotaur(spawnee)) spawnee.bAVOIDMELEE = true;
						if (MinotaurFriend(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Sorcerer1(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Sorcerer2(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (IceGuy(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Heresiarch(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Korax(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (Inquisitor(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Programmer(spawnee)) spawnee.bAVOIDMELEE = true;
						if (StrifeBishop(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Macil1(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Macil2(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Macil1(spawnee)) spawnee.bAVOIDMELEE = true;
						if (AlienSpectre1(spawnee)) spawnee.bAVOIDMELEE = true;
						if (AlienSpectre2(spawnee)) spawnee.bAVOIDMELEE = true;
						if (AlienSpectre3(spawnee)) spawnee.bAVOIDMELEE = true;
						if (AlienSpectre4(spawnee)) spawnee.bAVOIDMELEE = true;
						if (AlienSpectre5(spawnee)) spawnee.bAVOIDMELEE = true;
						if (EntityBoss(spawnee)) spawnee.bAVOIDMELEE = true;
					}
					
					if (monsterlevel >= (20 * levelmulfact))
					{
						if (Zombieman(spawnee) || ZombiemanNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (ShotgunGuy(spawnee) || ShotgunGuyNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (ChaingunGuy(spawnee) || ChaingunGuyNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (WolfensteinSS(spawnee) || WolfensteinSSNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (FlyingBalrog(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (IronLich(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Snake(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (Bishop(spawnee)) spawnee.bAVOIDMELEE = true;
						if (SerpentLeader(spawnee)) spawnee.bAVOIDMELEE = true;
						if (ClericBoss(spawnee)) spawnee.bAVOIDMELEE = true;
						if (FighterBoss(spawnee)) spawnee.bAVOIDMELEE = true;
						if (MageBoss(spawnee)) spawnee.bAVOIDMELEE = true;
			
						if (Acolyte(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Rebel(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Reaver(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Templar(spawnee)) spawnee.bAVOIDMELEE = true;
						if (EntitySecond(spawnee)) spawnee.bAVOIDMELEE = true;
						
						// AVOIDHAZARDS
						if (HammerDuck(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (PlanterBird(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (CentaurionSgt(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Vitriola(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Muddernaut(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Jugger(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Juggette(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (ReelHeel(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (SpiderCenser(spawnee)) spawnee.bAVOIDHAZARDS = true;
					}
					
					if (monsterlevel >= (25 * levelmulfact))
					{
						// AVOIDMELEE
						if (Fatso(spawnee) || MancubusNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Arachnotron(spawnee) || ArachnotronNew(spawnee) || RailArachnotron(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Archvile(spawnee) || ArchvileNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (BaronOfHell(spawnee) || BaronOfHellNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (HellCleric(spawnee) || HellClericDVDS(spawnee) || HellClericSpectral(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (Wizard(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Beast(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (FireDemon(spawnee)) spawnee.bAVOIDMELEE = true;
						if (CentaurLeader(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Demon1(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Demon2(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Wraith(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (Sentinel(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Crusader(spawnee)) spawnee.bAVOIDMELEE = true;
					}
					
					if (monsterlevel >= (30 * levelmulfact))
					{
						if (Teacher_Quis(spawnee)) spawnee.bAVOIDMELEE = true;
						if (QuisFake(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Teacher_Lauritz(spawnee)) spawnee.bAVOIDMELEE = true;
						if (GameMother(spawnee)) spawnee.bAVOIDMELEE = true;
						if (MossMother(spawnee)) spawnee.bAVOIDMELEE = true;
						if (HandMotherVac(spawnee)) spawnee.bAVOIDMELEE = true;
						
						// AVOIDHAZARDS
						if (SugarSnake(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (MiniSugarSnake(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (Cyberdemon(spawnee) || CyberdemonNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (SpiderMasterMind(spawnee) || SpiderMasterMindNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (UltraMastermind(spawnee)) spawnee.bAVOIDHAZARDS = true;
			
						if (Minotaur(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (MinotaurFriend(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Sorcerer1(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Sorcerer2(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (IceGuy(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Heresiarch(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Korax(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (Inquisitor(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Programmer(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (StrifeBishop(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Macil1(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Macil2(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Macil1(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (AlienSpectre1(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (AlienSpectre2(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (AlienSpectre3(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (AlienSpectre4(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (AlienSpectre5(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (EntityBoss(spawnee)) spawnee.bAVOIDHAZARDS = true;
					}
					
					if (monsterlevel >= (35 * levelmulfact))
					{
						if (DoomImp(spawnee) || DoomImpNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Cacodemon(spawnee) || CacodemonNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (PainElemental(spawnee) || PainElementalNew(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Revenant(spawnee) || RevenantNew(spawnee)) 
						{
							if (random(1,2) <= 1) spawnee.bAVOIDMELEE = true;
						}
						if (HellKnight(spawnee) || HellKnightNew(spawnee)) spawnee.bAVOIDMELEE = true;
						
						if (HereticImpLeader(spawnee)) spawnee.bAVOIDMELEE = true;
						if (MummyLeader(spawnee)) spawnee.bAVOIDMELEE = true;
						if (MummyLeaderGhost(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Knight(spawnee)) spawnee.bAVOIDMELEE = true;
					}
					
					if (monsterlevel >= (40 * levelmulfact))
					{
						if (Teacher_Jorg(spawnee)) spawnee.bAVOIDMELEE = true;
						if (Teacher_Vokter(spawnee)) spawnee.bAVOIDMELEE = true;
						if (HandMotherPhaseA(spawnee)) spawnee.bAVOIDMELEE = true;
						if (HandMotherPhaseB(spawnee)) spawnee.bAVOIDMELEE = true;
						if (HandMotherPhaseC(spawnee)) spawnee.bAVOIDMELEE = true;
						
						// AVOIDHAZARDS
						if (Zombieman(spawnee) || ZombiemanNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (ShotgunGuy(spawnee) || ShotgunGuyNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (ChaingunGuy(spawnee) || ChaingunGuyNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (WolfensteinSS(spawnee) || WolfensteinSSNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (FlyingBalrog(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (IronLich(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Snake(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (Bishop(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (SerpentLeader(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (ClericBoss(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (FighterBoss(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (MageBoss(spawnee)) spawnee.bAVOIDHAZARDS = true;
			
						if (Acolyte(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Rebel(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Reaver(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Templar(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (EntitySecond(spawnee)) spawnee.bAVOIDHAZARDS = true;
					}
					
					if (monsterlevel >= (50 * levelmulfact))
					{
						// AVOIDHAZARDS
						if (Fatso(spawnee) || MancubusNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Arachnotron(spawnee) || ArachnotronNew(spawnee) || RailArachnotron(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Archvile(spawnee) || ArchvileNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (BaronOfHell(spawnee) || BaronOfHellNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (HellCleric(spawnee) || HellClericDVDS(spawnee) || HellClericSpectral(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (Wizard(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Beast(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (FireDemon(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (CentaurLeader(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Demon1(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Demon2(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Wraith(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (Sentinel(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Crusader(spawnee)) spawnee.bAVOIDHAZARDS = true;
					}
					
					if (monsterlevel >= (60 * levelmulfact))
					{
						// AVOIDHAZARDS
						if (Teacher_Quis(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (QuisFake(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Teacher_Lauritz(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (GameMother(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (MossMother(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (HandMotherVac(spawnee)) spawnee.bAVOIDHAZARDS = true;
					}
					
					if (monsterlevel >= (70 * levelmulfact))
					{
						// AVOIDHAZARDS
						if (DoomImp(spawnee) || DoomImpNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Cacodemon(spawnee) || CacodemonNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (PainElemental(spawnee) || PainElementalNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Revenant(spawnee) || RevenantNew(spawnee)) 
						{
							if (spawnee.bAVOIDMELEE) 
							{
								if (random(1,2) <= 1) spawnee.bAVOIDHAZARDS = true;
							}
						}
						if (HellKnight(spawnee) || HellKnightNew(spawnee)) spawnee.bAVOIDHAZARDS = true;
						
						if (HereticImpLeader(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (MummyLeader(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (MummyLeaderGhost(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Knight(spawnee)) spawnee.bAVOIDHAZARDS = true;
					}
					
					if (monsterlevel >= (80 * levelmulfact))
					{
						// AVOIDHAZARDS
						if (Teacher_Jorg(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (Teacher_Vokter(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (HandMotherPhaseA(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (HandMotherPhaseB(spawnee)) spawnee.bAVOIDHAZARDS = true;
						if (HandMotherPhaseC(spawnee)) spawnee.bAVOIDHAZARDS = true;
					}
					
					int fastchance = 0;
					if (monsterlevel >= (25 * levelmulfact))
					{
						// ALWAYSFAST
						fastchance = 25;
						if (monsterlevel >= (50 * levelmulfact)) fastchance = randompick(62,63);
						if (monsterlevel >= (75 * levelmulfact)) fastchance = randompick(87,88);
						if (monsterlevel >= (100 * levelmulfact)) fastchance = 200;
						if (random(1,100) <= fastchance)
						{
							if (HellCleric(spawnee) || HellClericDVDS(spawnee) || HellClericSpectral(spawnee)) spawnee.bALWAYSFAST = true;
							if (Demon(spawnee) || DemonNew(spawnee)) spawnee.bALWAYSFAST = true;
							if (LostSoul(spawnee) || LostSoulNew(spawnee) || LostSoulAnnoying(spawnee)) spawnee.bALWAYSFAST = true;
							if (HereticImp(spawnee)) spawnee.bALWAYSFAST = true;
							if (Mummy(spawnee)) spawnee.bALWAYSFAST = true;
							if (Clink(spawnee)) spawnee.bALWAYSFAST = true;
							
							if (Ettin(spawnee)) spawnee.bALWAYSFAST = true;
							if (Centaur(spawnee)) spawnee.bALWAYSFAST = true;
							if (Serpent(spawnee)) spawnee.bALWAYSFAST = true;
							
							if (Stalker(spawnee)) spawnee.bALWAYSFAST = true;
						}
					}
					if (monsterlevel >= (50 * levelmulfact))
					{
						// ALWAYSFAST
						fastchance = 25;
						if (monsterlevel >= (100 * levelmulfact)) fastchance = randompick(62,63);
						if (monsterlevel >= (150 * levelmulfact)) fastchance = randompick(87,88);
						if (monsterlevel >= (200 * levelmulfact)) fastchance = 200;
						if (random(1,100) <= fastchance)
						{
							if (Forsaken(spawnee)) spawnee.bALWAYSFAST = true;
							if (Forsaken_Quisling(spawnee)) spawnee.bALWAYSFAST = true;
							if (Forsaken_Jorgensen(spawnee)) spawnee.bALWAYSFAST = true;
							if (Devil(spawnee)) spawnee.bALWAYSFAST = true;
						}
					}
				}
			}
		}
		EECreature spawnee2;
		spawnee2 = EECreature(spawnee);
		if (spawnee2) spawnee2.user_MaxHP = spawnee2.SpawnHealth() + spawnee2.Stamina;
	}
	
	override void WorldThingSpawned(WorldEvent e)
	{
		let globalvars = DDGlobalVariables.Get();
		actor player = players[0].mo;
		let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
		int PLuck;
		if (MiscItem) PLuck = MiscItem.PlayerLUCK;
		
		class<Actor> extracheck, extracheck2, extracheck3, extracheck4;
		string nm, nn, no, np;
		actor spawnee = e.thing;
		actor source;
		actor mastor;
		source = spawnee.target;
		mastor = spawnee.master;
		string spawnname = spawnee.GetClassName();
		int user_base = 0;
		string usertype = "";
		double hpmulti, atkmulti, defmulti, spdmulti, massmulti;
		int TruePlayerLevel = 0;
		if (exex_expenabled && MiscItem) TruePlayerLevel = MiscItem.PlayerLevel;
		
		Inventory IsInv;
		IsInv = Inventory(spawnee);
		if (IsInv) 
		{
			if (YellowCard(IsInv) || BlueCard(IsInv) || RedCard(IsInv)) IsInv.PickupSound = "getkeycard";
			if (YellowSkull(IsInv) || BlueSkull(IsInv) || RedSkull(IsInv)) IsInv.PickupSound = "getskullkey";
		}
		
		if (spawnee && !BowlingPin(spawnee) && !DDMiniTank(spawnee) && !DDHoganTarget(spawnee) && !OldPipe(spawnee) && !DDAFDNPC(spawnee))
		{
			int basemonsterrating = spawnee.CountInv("MonsterRating");
			bool practicetarget;
			if (PracticeTarget(spawnee) || PracticeTarget2(spawnee)) practicetarget = true;

			EECreature NightmareCreature;
			NightmareCreature = EECreature(spawnee);
			if (NightmareCreature)
			{
				// Nightmare Monster Controls
				if (NightmareCentaurion(NightmareCreature) ||
						NightmareCentaurionSgt(NightmareCreature) ||
						NightmareBellefish_Fly(NightmareCreature) ||
						NightmareReelHeel(NightmareCreature) ||
						NightmareNurse(NightmareCreature) ||
						NightmareSpectre(NightmareCreature) ||
						NightmareBloodSpectre(NightmareCreature))
				{
					NightmareCreature.nightmarealphatimeroffset = random(-34,34);
					NightmareCreature.nightmarephaserand = random(0,6);
				}
			}
			
			// Tags
			double spdfactor;
			if (spawnname == "DoomImpBall") 
			{
				spawnee.SetTag("Imp Fireball");
				ProjSetSpeed(spawnee);
			}
			if (spawnname == "CacodemonBall") 
			{
				spawnee.SetTag("Lightning Ball");
				ProjSetSpeed(spawnee);
			}
			if (spawnname == "RevenantTracer") 
			{
				spawnee.SetTag("Tracer Missile");
				ProjSetSpeed(spawnee);
			}
			if (spawnname == "ArachnotronPlasma")
			{
				spawnee.SetTag("Plasma Ball");
				ProjSetSpeed(spawnee);
			}
			if (spawnname == "ArchvileFire")
			{
				spawnee.SetTag("Vile FireHex");
				ProjSetSpeed(spawnee);
			}
			if (spawnname == "BaronBall")
			{
				spawnee.SetTag("HellNoble Plasma");
				ProjSetSpeed(spawnee);
			}
			if (spawnname == "FatShot")
			{
				spawnee.SetTag("Flamer Shot");
				ProjSetSpeed(spawnee);
			}
			if (spawnname == "Rocket")
			{
				spawnee.SetTag("Rocket");
				ProjSetSpeed(spawnee);
			}
			
			if (EEProjectile(spawnee)) ProjSetSpeed(spawnee);
			if (spawnee.bMISSILE) ProjSetSpeed(spawnee);
			
			// Changes
			int basehealth = spawnee.SpawnHealth();
			double healthmulfactor = 0.01;
			
			nm = "Balloon_Red"; extracheck = nm;
			nn = "Balloon_Red2"; extracheck2 = nn;
			if (spawnname == extracheck || spawnname == extracheck2)
			{
				if (random(1,16) <= 1)
				{
					user_base = random(1,3);
					if (user_base == 1) usertype = "Balloon_Blue";
					if (user_base == 2) usertype = "Balloon_Green";
					if (user_base == 3) usertype = "Balloon_Yellow";
				}
			}
			nm = "Balloon"; extracheck = nm;
			nn = "BallTarg"; extracheck2 = nn;
			if (spawnname == extracheck || spawnname == extracheck2)
			{
				if (random(1,16) <= 1)
				{
					user_base = random(1,2);
					if (user_base == 1) usertype = "BallGreen";
					if (user_base == 2) usertype = "BallYel";
				}
			}

			nm = "Balloon_Yellow"; extracheck = nm; 
			if (spawnname == extracheck)
			{
				if (random(1,16) <= 1)
				{
					user_base = random(1,3);
					if (user_base == 1) usertype = "Balloon_Blue";
					if (user_base == 2) usertype = "Balloon_Green";
					if (user_base == 3) usertype = "Balloon_Red";
				}
			}
			nm = "BallYel"; extracheck = nm; 
			if (spawnname == extracheck)
			{
				if (random(1,16) <= 1)
				{
					user_base = random(1,2);
					if (user_base == 1) usertype = "BallGreen";
					if (user_base == 2) usertype = "Balloon";
				}
			}

			nm = "Balloon_Green"; extracheck = nm; 
			if (spawnname == extracheck)
			{
				if (random(1,16) <= 1)
				{
					user_base = random(1,3);
					if (user_base == 1) usertype = "Balloon_Blue";
					if (user_base == 2) usertype = "Balloon_Yellow";
					if (user_base == 3) usertype = "Balloon_Red";
				}
			}
			nm = "BallGreen"; extracheck = nm; 
			if (spawnname == extracheck)
			{
				if (random(1,16) <= 1)
				{
					user_base = random(1,2);
					if (user_base == 1) usertype = "BallYel";
					if (user_base == 2) usertype = "Balloon";
				}
			}

			nm = "Balloon_Blue"; extracheck = nm; 
			if (spawnname == extracheck)
			{
				if (random(1,16) <= 1)
				{
					user_base = random(1,3);
					if (user_base == 1) usertype = "Balloon_Green";
					if (user_base == 2) usertype = "Balloon_Yellow";
					if (user_base == 3) usertype = "Balloon_Red";
				}
			}
			if (user_base)
			{
				//Console.Printf("%s [2]", spawnname);
				spawnee.A_SpawnItemEx(usertype,0,0,0,0,0,0,0,SXF_NOCHECKPOSITION,0,spawnee.tid);
				spawnee.Destroy();
			}
			
			bool specialenemy = false;
			bool ispeasant = false;
			// Strife Peasants
			if (Peasant(spawnee)) ispeasant = true;

			// Eviternity's Archangelus Boss
			nm = "ArchangelusA"; extracheck = nm;
			if (spawnname == extracheck) 
			{
				if (Skill <= 0) healthmulfactor = 0.0075;
				if (Skill == 1) healthmulfactor = 0.00875;
				if (Skill == 2) healthmulfactor = 0.01;
				if (Skill == 3) healthmulfactor = 0.01125;
				if (Skill >= 4) healthmulfactor = 0.0125;
				basehealth *= (1.0 * (TruePlayerLevel * healthmulfactor));
				if (Skill <= 0) basehealth *= 12;
				if (Skill == 1) basehealth *= 14;
				if (Skill == 2) basehealth *= 16;
				if (Skill == 3) basehealth *= 18;
				if (Skill >= 4) basehealth *= 20;
				spawnee.health *= basehealth;
			}
			nn = "ArchangelusB"; extracheck = nm;
			if (spawnname == extracheck) 
			{
				if (Skill <= 0) healthmulfactor = 0.01125;
				if (Skill == 1) healthmulfactor = 0.013125;
				if (Skill == 2) healthmulfactor = 0.015;
				if (Skill == 3) healthmulfactor = 0.016875;
				if (Skill >= 4) healthmulfactor = 0.01875;
				basehealth *= (1.0 * (TruePlayerLevel * healthmulfactor));
				if (Skill <= 0) basehealth *= 12;
				if (Skill == 1) basehealth *= 14;
				if (Skill == 2) basehealth *= 16;
				if (Skill == 3) basehealth *= 18;
				if (Skill >= 4) basehealth *= 20;
				spawnee.health = basehealth;
			}
			// TUTNT's Source Boss
			nm = "TheSource"; extracheck = nm;
			if (spawnname == extracheck) 
			{
				if (Skill <= 0) healthmulfactor = 0.005625;
				if (Skill == 1) healthmulfactor = 0.0065625;
				if (Skill == 2) healthmulfactor = 0.0075;
				if (Skill == 3) healthmulfactor = 0.0084375;
				if (Skill >= 4) healthmulfactor = 0.009375;
				basehealth *= (1.0 * (TruePlayerLevel * healthmulfactor));
				if (Skill <= 0) basehealth *= 6;
				if (Skill == 1) basehealth *= 7;
				if (Skill == 2) basehealth *= 8;
				if (Skill == 3) basehealth *= 9;
				if (Skill >= 4) basehealth *= 10;
				spawnee.health = basehealth;
				specialenemy = true;
			}
			
			// Keeps the Romero Heads in AUGER ZENITH, which can't be attacked directly by the player, from being able to gain extra HP/Stats so they can be killed properly on MAP21
			if (player.CountInv("PlayingAugerZenith") && (BossBrainNew(spawnee))) specialenemy = true;
			
			// Going Down's MAP29 "Boss"
			if (player.CountInv("PlayingGoingDown") && (WolfensteinSS(spawnee) || WolfensteinSSNew(spawnee)))
			{
				spawnee.health = 12000;
			}

			if (Revenant(spawnee) || RevenantNew(spawnee)) spawnee.ProjectilePassHeight = 84;
			if (Demon1(spawnee) || Demon2(spawnee)) spawnee.ProjectilePassHeight = 104;

			if (ArchvileFire(spawnee))
			{
				spawnee.A_SetRenderStyle(frandom(0.625,0.875),STYLE_Add);
			}

			if (DDOrigCreature(spawnee))
			{
				if (ddafd_actorhealthlevel)
				{
					if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls"))
					{
						if (skill <= 1) spawnee.health *= 0.5;
					}
				}

				if (!(DDOrigBoss(spawnee) || SugarSnake(spawnee) || MiniSugarSnake(spawnee)))
				{
					if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) spawnee.bLOOKALLAROUND = false;
				}
			}
			
			// Monster "Scaling"
			MonsterStatsSet(spawnee, basemonsterrating, practicetarget, specialenemy, ispeasant);
			
			if (CroquetBall(spawnee) && (spawnee.target && HammerDuck(spawnee.target)))
			{
				if (exex_monsterlevelenabledflags && spawnee.target.CountInv("MonsterLevel") > 15)
				{
					spawnee.Speed = 24;
				}
				if (exex_monsterlevelenabledflags && spawnee.target.CountInv("MonsterLevel") > 30)
				{
					spawnee.Speed = 32;
				}
				if (exex_monsterlevelenabledflags && spawnee.target.CountInv("MonsterLevel") > 45)
				{
					spawnee.Speed = 40;
				}
				if (exex_monsterlevelenabledflags && spawnee.target.CountInv("MonsterLevel") > 60)
				{
					spawnee.Speed = 48;
				}
			}
		}
		
		Super.WorldThingSpawned(e);
	}

	override void WorldThingRevived(WorldEvent e)
	{
		if (Level.MapName != "TITLEMAP")
		{
			let globalvars = DDGlobalVariables.Get();
			actor player = players[0].mo;
			let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
			
			class<Actor> extracheck, extracheck2, extracheck3, extracheck4;
			string nm, nn, no, np;
			actor spawnee = e.thing;
			string spawnname = spawnee.GetClassName();
			int TruePlayerLevel = 0;
			if (exex_expenabled && MiscItem) TruePlayerLevel = MiscItem.PlayerLevel;
			
			if (spawnee)
			{
				DedMonsterFlag dedcheckitem;
				dedcheckitem = DedMonsterFlag(spawnee.FindInventory("DedMonsterFlag"));
				if (dedcheckitem)
				{
					spawnee.A_SetRenderStyle(dedcheckitem.ownerorigalpha,dedcheckitem.ownerorigrender);
					dedcheckitem.Destroy();
				}
				
				
				nm = "ClayDevilNew"; extracheck = nm;
				if (spawnname == extracheck)
				{
					spawnee.speed = spawnee.default.speed;
					spawnee.DamageMultiply = spawnee.default.DamageMultiply;
					spawnee.DamageFactor = spawnee.default.DamageFactor;
					spawnee.health = spawnee.SpawnHealth();
					spawnee.Mass = spawnee.default.mass;
					spawnee.SetTag(spawnee.default.GetTag());
					MonsterStatsSet(spawnee, 0, false, false, false);
				}
				
				if (spawnee)
				{
					spawnee.A_SetInventory("JustRevived",1);
					if (dydudebug_ressurrectdisplays) Console.Printf("Res: Max Health - %d (%d + %d)", (spawnee.SpawnHealth() + spawnee.Stamina), spawnee.SpawnHealth(), spawnee.Stamina); 
					if (spawnee.bISMONSTER && spawnee.Stamina > 0)
					{
						spawnee.health = spawnee.SpawnHealth() + spawnee.Stamina;
					}
				}
			}
		}
		Super.WorldThingRevived(e);
	}

	override void WorldThingDamaged(WorldEvent e)
	{
		if (Level.MapName != "TITLEMAP")
		{
			if (dydudebug_hitsounds) Console.Printf("hitsounds (WorldThingDamaged check)");
			actor player = players[0].mo;
			let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
			int blundebuff = 0;
			int scramblerdebuff = 0;
			actor victim = e.Thing;
			actor source = e.DamageSource;
			actor inflicter = e.inflictor;
			int dmg = e.damage;
			int initdmg = e.damage;
			string mod = e.damagetype;
			int flags = e.DamageFlags;
			int PLuck;
			int TrueLuck;
			int TruePlayerLevel = 0;
			if (exex_expenabled && MiscItem) TruePlayerLevel = MiscItem.PlayerLevel;

			let globalvars = DDGlobalVariables.Get();
			if (MiscItem) 
			{
				PLuck = MiscItem.PlayerLUCK;
				if (skill <= 0) TrueLuck = random((PLuck*0.75),PLuck);
				if (skill == 1) TrueLuck = random((PLuck*0.625),PLuck);
				if (skill == 2) TrueLuck = random((PLuck*0.5),PLuck);
				if (skill == 3) TrueLuck = random((PLuck*0.375),PLuck);
				if (skill >= 4) TrueLuck = random((PLuck*0.25),PLuck);
				TrueLuck *= exex_pluckfactor;
			}
			
			class<Actor> extracheck, extracheck2, extracheck3, extracheck4;
			string nm, nn, no, np;
			
			if (victim)
			{
				if (dydudebug_hitsounds) Console.Printf("hitsounds (victim check)");
				int oldhealth = victim.health;

				string victname = victim.GetTag();
				string atkrname = "(?)";
				int user_type;
				string vict = "NONE";
				string infl = "NONE";
				string sour = "NONE";
				int landdamagebonus;

				if (victim) vict = victim.GetClassName();
				if (inflicter) infl = inflicter.GetClassName();
				if (source) sour = source.GetClassName();

				bool showdmglog;
				bool practicetarget;
				
				int specialtype;
				nm = "CCardGhostMarker";
				if (victim.CountInv(nm)) specialtype += 1;
				nm = "CCardAssassinMarker";
				if (victim.CountInv(nm)) specialtype += 2;
				nm = "CCardRespawnedMarker";
				if (victim.CountInv(nm)) specialtype += 4;
				if (dydudebug_worlddamaged) Console.Printf("[%s] SpecialType [WorldDamaged]: %d", vict, specialtype);

				/*
				// Ally Check
				actor IsRebel;
				if (!DDPlayerPawn(victim) && DDPlayerPawn(source))
				{
					if (victim.bFRIENDLY)
					{
						if (victim.master && DDPlayerPawn(victim.master))
						{
							if (e.damage)
							{
								e.damage = 0;
								if (dydudebug_worlddamaged) Console.Printf("Victim is Player's ally! No Damage inflicted!");
								Super.WorldThingDamaged(e);
								return;
							}
						}
						else
						{
							if (IsRebel = Rebel(victim) && e.damage)
							{
								e.damage = 0;
								if (dydudebug_worlddamaged) Console.Printf("Victim is Strife Rebel! No Damage inflicted!");
								Super.WorldThingDamaged(e);
								return;
							}
						}
					}
				}
				*/
				
				if (victim.bCOUNTKILL || specialtype) showdmglog = true;
				if (PracticeTarget(victim) || PracticeTarget2(victim)) 
				{
					practicetarget = true;
					showdmglog = true;
				}
				if (BossBrainNew(victim)) showdmglog = true;
				if (DDPlayerPawn(victim) || BowlingPin(victim) || OldPipe(victim)) showdmglog = false;
				nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) showdmglog = false;
				if (mod == 'SilentMassacre') showdmglog = false;
				if (mod == 'GrowingPains') showdmglog = false;
				if (showdmglog)
				{
					//Console.Printf("showdmglog");

					if (dydudebug_worlddamaged) Console.Printf("\c[purple]Attack: %s, \c[brick]Attacker: %s", infl, sour);
					
					if (victim.health > 0 && victim.bISMONSTER)
					{
						if (source && DDPlayerPawn(source)) //
						{
							let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
							if (MiscItem) landdamagebonus = MiscItem.landdmgbonus;
							if (dydudebug_worlddamaged) Console.Printf("landdamagebonus: %d", landdamagebonus);
						}
						if (!practicetarget)
						{
							if (infl == "PlayerWhistle")
							{
								double ang;
								if (source) ang = source.angle;
								else if (inflicter) ang = inflicter.angle;
								double force = frandompick(13.75,15,16.25);
								force *= 0.25;
								if (inflicter && (source.CountInv("PowerStrength") || source.CountInv("PowerStrengthDD"))) force *= frandompick(1.5,2,2.5);

								victim.Vel.Z += force;
								victim.thrust(force, (ang + frandompick(-3,-1.5,-1.5,0,0,0,0,0,1.5,1.5,3)));
							}
							if (infl == "UppercutPuff")
							{
								double ang;
								if (source) ang = source.angle;
								else if (inflicter) ang = inflicter.angle;
								double force = frandompick(27.5,30,32.5);
								force *= 0.25;
								if (source)
								{
									if (source.CountInv("PowerStrength") || source.CountInv("PowerStrengthDD")) force *= frandompick(1.125,1.25,1.375);
									if (source.CountInv("DinahTrueIPState")) force *= 12.5;
								}

								if (random(1,8) <= 1) force *= 1.5;
								victim.Vel.Z += force;
								victim.thrust(force, (ang + frandompick(-6,-3,-3,0,0,0,0,0,3,3,6)));
							}
							if (KickPuff(inflicter) || KickPuffNoThrust(inflicter) || BadKickPuff(inflicter))
							{
								double ang;
								if (source) ang = source.angle;
								else if (inflicter) ang = inflicter.angle;
								double force = frandompick(27.5,30,32.5);
								force *= 0.05;
								if (random(1,2) <= 1) force *= -1;
								if (source)
								{
									if (source.CountInv("PowerStrength") || source.CountInv("PowerStrengthDD")) force *= frandompick(1.125,1.25,1.375);
									if (source.CountInv("DinahTrueIPState")) force *= 12.5;
								}

								if (random(1,8) <= 1) force *= 1.5;
								victim.Vel.Z += force;
								victim.Thrust(force, (ang + (frandompick(-6,-3,-3,0,0,0,0,0,3,3,6) * 0.25)));
							}
						}

						if (!victim.bINVULNERABLE || !practicetarget)
						{
							// Scrambler = Inflicts confusion/fear on enemies occasionally, causing hestitation in combat
							if (PanPuff(inflicter))
							{
								if (!victim.bNOFEAR)
								{
									double basedebuffchance = 25.0;
									int basepoint = 15;
									if (MiscItem)
									{
										if (TruePlayerLevel >= (basepoint * 0.5)) basedebuffchance = 25.625;
										if (TruePlayerLevel >= (basepoint * 1.0)) basedebuffchance = 26.25;
										if (TruePlayerLevel >= (basepoint * 2.0)) basedebuffchance = 27.5;
										if (TruePlayerLevel >= (basepoint * 3.0)) basedebuffchance = 28.75;
										if (TruePlayerLevel >= (basepoint * 4.0)) basedebuffchance = 30.0;
										if (TruePlayerLevel >= (basepoint * 5.0)) basedebuffchance = 31.25;
										if (TruePlayerLevel >= (basepoint * 6.0)) basedebuffchance = 32.5;
										if (TruePlayerLevel >= (basepoint * 7.0)) basedebuffchance = 33.75;
										if (TruePlayerLevel >= (basepoint * 8.0)) basedebuffchance = 35.0;
										if (TruePlayerLevel >= (basepoint * 9.0)) basedebuffchance = 37.5;
									}
									if (PLuck) 
									{
										if (MiscItem)
										{
											if (TruePlayerLevel >= 0) basedebuffchance += (TrueLuck * frandompick(0,0,0,0.25,0.25,0.5,0.5,1.0,2.0));
											else if (TruePlayerLevel >= (basepoint * 3.0)) basedebuffchance += (TrueLuck * frandompick(0,0,0.25,0.25,0.25,0.5,0.5,1.0,2.0));
											else if (TruePlayerLevel >= (basepoint * 6.0)) basedebuffchance += (TrueLuck * frandompick(0,0.25,0.25,0.25,0.25,0.5,0.5,1.0,2.0));
											else if (TruePlayerLevel >= (basepoint * 9.0)) basedebuffchance += (TrueLuck * frandompick(0.25,0.25,0.25,0.25,0.5,0.5,0.5,1.0,2.0));
										}
										else basedebuffchance += (TrueLuck * frandompick(0,0,0,0.25,0.25,0.5,0.5,1.0,2.0));
									}
									if (HellCleric(victim) || HellClericDVDS(victim) || HellClericSpectral(victim)) basedebuffchance *= 2.5;
									if (Teacher_VokterClone(victim))
									{
										if (victim.CountInv("VokterCloneShield") || victim.CountInv("VokterCloneShield2"))
										{
											basedebuffchance = 0;
										}
										else if (victim.CountInv("VokterCloneStun"))
										{
											basedebuffchance *= 2;
										}
										else
										{
											basedebuffchance *= frandompick(0.625,0.75,0.875);
										}
									}
									if (victim.bBOSS) basedebuffchance *= 0.25;
									if (CyberDemon(victim) || CyberDemonNew(victim)) basedebuffchance *= 0.5;
									if (HellKnight(victim) || HellKnightNew(victim) || BaronOfHell(victim) || BaronOfHellNew(victim)) basedebuffchance *= 0.75;
									if (Cacodemon(victim) || CacodemonNew(victim) || PainElemental(victim) || PainElementalNew(victim)) basedebuffchance *= 0.8;
									if (Demon(victim) || DemonNew(victim) || Spectre(victim) || SpectreNew(victim)) basedebuffchance *= 0.8888888888888889;
									if (Arachnotron(victim) || ArachnotronNew(victim) || RailArachnotron(victim) || Fatso(victim) || MancubusNew(victim)) basedebuffchance *= 1.3334;
									if (Archvile(victim) || ArchvileNew(victim) || Revenant(victim) || RevenantNew(victim)) basedebuffchance *= 1.5;
									if (SpiderMastermind(victim) || SpiderMastermindNew(victim)) basedebuffchance *= 3;
									if (LostSoul(victim) || LostSoulNew(victim)) basedebuffchance *= 10;
									if (landdamagebonus == 1) basedebuffchance *= 1.142857142857143;
									if (landdamagebonus == 2) basedebuffchance *= 1.428571428571429;
									if (landdamagebonus == 3) basedebuffchance *= 2.105263157894737;
									if (landdamagebonus == 4) basedebuffchance *= 5;
									if (source.CountInv("PowerStrength") || 
											source.CountInv("PowerStrengthDD"))
									{
										if (victim.bBOSS) basedebuffchance *= 10;
																	else basedebuffchance *= 2.5;
									}
									if (PanPuffIP(inflicter)) basedebuffchance *= 3.334;
									if (basedebuffchance < 1) basedebuffchance = 1;
									if (dydudebug_worlddamaged) Console.Printf("basedebuffchance: %.2f / 100", basedebuffchance);
									if (frandom(0.1,100.0) <= basedebuffchance)
									{
										if (ddafd_disablescramblerdebuff && (source.CountInv("IsDynDuchess") || source.CountInv("IsAppetite") || source.CountInv("IsCarnOfSouls")))
										{
										}
										else
										{
											victim.A_SetInventory("ScramblerConfusion",1);
										}
									}
								}
							}

							// Blunderaxe = Tears off Armor Scraps at times, and occasionally inflicts a "Helm Splitter" style defense debuff
							if (BlunderPuff(inflicter))
							{
								int baseval = randompick(5,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,9);
								if (!practicetarget)
								{
									if (PLuck) baseval -= (TrueLuck * 0.067);
									if (dydudebug_worlddamaged) Console.Printf("%d", baseval);
									string armortype = "ArmorScrap";
									if (random(1,4096) <= 1) armortype = "ArmorScrapKit";
									if (random(1,(baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
									if (random(1,4096) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
									if (random(1,(baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
									if (random(1,4096) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
									if (random(1,(baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
									if (random(1,4096) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
									if (random(1,(baseval*baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
									if (random(1,4096) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
									if (random(1,(baseval*baseval*baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
									if (random(1,4096) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
									if (random(1,(baseval*baseval*baseval*baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
								}
								
								double basedebuffchance = 25.0;
								if (MiscItem)
								{
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 0.5)) basedebuffchance = 25.625;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 1.0)) basedebuffchance = 26.25;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 2.0)) basedebuffchance = 27.5;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 3.0)) basedebuffchance = 28.75;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 4.0)) basedebuffchance = 30.0;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 5.0)) basedebuffchance = 31.25;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 6.0)) basedebuffchance = 32.5;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 7.0)) basedebuffchance = 33.75;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 8.0)) basedebuffchance = 35.0;
									if (TruePlayerLevel >= (exex_axecombolvlrequirement * 9.0)) basedebuffchance = 37.5;
								}
								if (PLuck) 
								{
									if (MiscItem)
									{
										if (TruePlayerLevel >= 0) basedebuffchance += (TrueLuck * frandompick(0,0,0,0.25,0.25,0.5,0.5,1.0,2.0));
										else if (TruePlayerLevel >= (exex_axecombolvlrequirement * 3.0)) basedebuffchance += (TrueLuck * frandompick(0,0,0.25,0.25,0.25,0.5,0.5,1.0,2.0));
										else if (TruePlayerLevel >= (exex_axecombolvlrequirement * 6.0)) basedebuffchance += (TrueLuck * frandompick(0,0.25,0.25,0.25,0.25,0.5,0.5,1.0,2.0));
										else if (TruePlayerLevel >= (exex_axecombolvlrequirement * 9.0)) basedebuffchance += (TrueLuck * frandompick(0.25,0.25,0.25,0.25,0.5,0.5,0.5,1.0,2.0));
									}
									else basedebuffchance += (TrueLuck * frandompick(0,0,0,0.25,0.25,0.5,0.5,1.0,2.0));
								}
								
								if (CyberDemon(victim) || CyberDemonNew(victim)) basedebuffchance *= 3;
								if (HellKnight(victim) || HellKnightNew(victim) || BaronOfHell(victim) || BaronOfHellNew(victim)) basedebuffchance *= 2;
								if (Cacodemon(victim) || CacodemonNew(victim) || PainElemental(victim) || PainElementalNew(victim)) basedebuffchance *= 1.6;
								if (Demon(victim) || DemonNew(victim) || Spectre(victim) || SpectreNew(victim)) basedebuffchance *= 1.333333333333333;
								if (Arachnotron(victim) || ArachnotronNew(victim) || RailArachnotron(victim) || Fatso(victim) || MancubusNew(victim)) basedebuffchance *= 4;
								if (Archvile(victim) || ArchvileNew(victim) || Revenant(victim) || RevenantNew(victim)) basedebuffchance *= 0.75;
								if (SpiderMastermind(victim) || SpiderMastermindNew(victim)) basedebuffchance *= 0.5;
								if (LostSoul(victim) || LostSoulNew(victim)) basedebuffchance *= 0.1;
								if (victim.bBOSS) basedebuffchance *= 0.25;
								if (HellCleric(victim) || HellClericDVDS(victim) || HellClericSpectral(victim)) basedebuffchance *= 2.5;
								if (Teacher_VokterClone(victim))
								{
									if (victim.CountInv("VokterCloneShield") || victim.CountInv("VokterCloneShield2"))
									{
										basedebuffchance = 0;
									}
									else if (victim.CountInv("VokterCloneStun"))
									{
										basedebuffchance *= 2;
									}
									else
									{
										basedebuffchance *= frandompick(0.625,0.75,0.875);
									}
								}
								if (landdamagebonus == 1) basedebuffchance *= 1.142857142857143;
								if (landdamagebonus == 2) basedebuffchance *= 1.428571428571429;
								if (landdamagebonus == 3) basedebuffchance *= 2.105263157894737;
								if (landdamagebonus == 4) basedebuffchance *= 5;
								if (source.CountInv("PowerStrength") ||
										source.CountInv("PowerStrengthDD"))
								{
									if (victim.bBOSS) basedebuffchance *= 10;
															 else basedebuffchance *= 2.5;
								}
								if (basedebuffchance < 1) basedebuffchance = 1;
								if (dydudebug_worlddamaged) Console.Printf("basedebuffchance: %.2f / 100", basedebuffchance);
								if (frandom(0.1,100.0) <= basedebuffchance)
								{
									if (ddafd_disableaxedebuff && (source.CountInv("IsDynDuchess") || source.CountInv("IsAppetite") || source.CountInv("IsCarnOfSouls")))
									{
									}
									else
									if (!dydudebug_practicetargetsdebuff && (PracticeTarget(victim) || PracticeTarget2(victim)))
									{
									}
									else
									{
										if (victim.CountInv("BlunderHelmSplitter3"))
										{
											blundebuff = 4;
										}
										else
										{
											if (victim.CountInv("BlunderHelmSplitter2"))
											{
												blundebuff = 3;
												victim.A_SetInventory("BlunderHelmSplitter3",1);
												victim.A_SetInventory("BlunderHelmSplitter2",0);
												victim.A_SetInventory("BlunderHelmSplitter",0);
											}
											else
											{
												if (victim.CountInv("BlunderHelmSplitter"))
												{
													victim.A_SetInventory("BlunderHelmSplitter3",0);
													victim.A_SetInventory("BlunderHelmSplitter2",1);
													victim.A_SetInventory("BlunderHelmSplitter",0);
													blundebuff = 2;
												}
												else
												{
													victim.A_SetInventory("BlunderHelmSplitter3",0);
													victim.A_SetInventory("BlunderHelmSplitter2",0);
													victim.A_SetInventory("BlunderHelmSplitter",1);
													blundebuff = 1;
												}
											}
										}
									}
								}
							}
						}
					}
				}
				
				if (victim.health <= 0 && mod == 'Ice') victim.bCANTSEEK = true;
				
				string attkernam;
				if (!victim.GetTag()) victname = vict;
				if (source)
				{
					if (source.GetTag()) attkernam = source.GetTag();
													else attkernam = source.GetClassName();
				}
				if (inflicter)
				{
					if (inflicter.GetTag()) atkrname = inflicter.GetTag();
														 else atkrname = inflicter.GetClassName();
				}
				string comblog = "";
				comblog.AppendFormat("\c[red]*\c- ");
				showdmglog = false;
				if (victim.bCOUNTKILL || specialtype || DDAFDNPC(victim)) showdmglog = true;
				if (PracticeTarget(victim) || PracticeTarget2(victim)) showdmglog = true;
				if (BossBrainNew(victim)) showdmglog = true;
				if (DDPlayerPawn(victim)) showdmglog = false;
				if (Galgoyle_Hide(victim)) showdmglog = false;
				if (BowlingPin(victim) || DDHoganTarget(victim) || OldPipe(victim)) showdmglog = false;
				nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) showdmglog = false;
				if (mod == 'SilentMassacre') showdmglog = false;
				if (mod == 'GrowingPains') showdmglog = false;
				if (exex_combatlog && showdmglog)
				{
					//Console.Printf("showdmglog 2");
					if (mod == 'NONE') mod = 'Typeless';
					if (dmg)
					{
						comblog.AppendFormat("\c[brick]%d\c-", dmg);
						if (victim.CountInv("JustSurprised") > 0) comblog.AppendFormat(" \c[sapphire]SURPRISE\c-");
						if (victim.CountInv("TookCriticalHit") > 0) comblog.AppendFormat(" \c[orange]CRITICAL\c-");
						comblog.AppendFormat(" damage dealt to \c[red]%s\c- by", victname);
						if (inflicter && source && (inflicter != source)) comblog.AppendFormat(" \c[purple]%s's", attkernam);
						if (inflicter) comblog.AppendFormat(" \c[red]%s\c-!", atkrname);
						comblog.AppendFormat(" [\c[lightblue]%s\c-]", mod);
						if (flags & DMG_EXPLOSION) comblog.AppendFormat(" \c[brick][AOE]\c-");
						if (victim.health <= 0) 
						{
							if (DDAFDNPC(victim) && !VacPuff(inflicter)) comblog.AppendFormat(" \c[orange]%s has been knocked senseless!\c-", victname);
							else comblog.AppendFormat(" \c[brick]%s dies!\c-", victname);
						}
					}
					else
					{
						comblog.AppendFormat("\c[red]%s\c- took \c[purple]no damage\c- from", victname);
						if (inflicter && source && (inflicter != source)) comblog.AppendFormat(" \c[purple]%s's", attkernam);
						if (inflicter) comblog.AppendFormat(" \c[red]%s\c-!", atkrname);
						comblog.AppendFormat(" [\c[lightblue]%s\c-]", mod);
					}
					if (dydudebug_showgametic) comblog.AppendFormat(" [%d]", gametic);
					
					Console.Printf(comblog);
					if (blundebuff && (victim.health > 0))
					{
						if (blundebuff >= 4) Console.Printf("\c[red]*\c- \c[purple]%s's\c- defense has already been dropped as much as it can!", victname);
						if (blundebuff == 3) Console.Printf("\c[red]*\c- \c[purple]%s's\c- defense dropped by yet another 30%!", victname);
						if (blundebuff == 2) Console.Printf("\c[red]*\c- \c[purple]%s's\c- defense dropped by another 30%!", victname);
						if (blundebuff == 1) Console.Printf("\c[red]*\c- \c[purple]%s's\c- defense dropped by 30%!", victname);
						if (blundebuff <= 3 && sour == "DinahPlayer") 
						{
							if (MiscItem && MiscItem.CanTalkUnderwater)
							{
								double maskpitch = 1.00;
								if (source.waterlevel >= 3 && MiscItem.CanTalkUnderwater >= 2) maskpitch *= 1.259921885;
								source.A_StopSound(CHAN_VOICE);
								source.A_StartSound("Dinah/Gotcha",CHAN_VOICE,CHANF_DEFAULT,1.0,ATTN_NORM,maskpitch);
							}
						}
					}
				}
				
				if (dydudebug_hitsounds) Console.Printf("hitsounds");
				bool makesound;
				string playedsound = "";
				PlayerPawn playpawn;
				Actor othermon;
				int playweaksound = 0;
				//*******************
				//* Weakness Sounds *
				//*******************
				int tempdmgval = 10000;
				double tempdmgfactor = victim.damagefactor;
				victim.damagefactor = 1.0;
				int moddedDMG = victim.ApplyDamageFactor(mod, tempdmgval);
				victim.damagefactor = tempdmgfactor;
				double outputdmgfactor = 1.0;
				outputdmgfactor *= moddedDMG;
				outputdmgfactor /= tempdmgval;
				bool playwsounds = false;
				if (vict != "PracticeTarget" || vict != "PracticeTarget2" || vict != "BowlingPin" || vict != "OldPipe") playwsounds = true;
				nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) playwsounds = false;
				if (BowlingPin(victim) || DDHoganTarget(victim) || OldPipe(victim)) playwsounds = false;
				if (mod == 'SilentMassacre') playwsounds = false;
				if (mod == 'GrowingPains') playwsounds = false;
				
				if (playwsounds)
				{
					if (initdmg > 0 && !(flags & DMG_NO_FACTOR)) 
					{
						if (!(mod == '' || mod == 'Normal' || mod == 'Crush' || mod == 'Falling' || mod == 'Drowning'))
						{
							if (moddedDMG <= (tempdmgval * 0.25)) playweaksound = -3;
							if (moddedDMG >= (tempdmgval * 0.25) && moddedDMG <= (tempdmgval * 0.3999999)) playweaksound = -2;
							if (moddedDMG >= (tempdmgval * 0.4) && moddedDMG <= (tempdmgval * 0.6666667)) playweaksound = -1;
							if (moddedDMG >= (tempdmgval * 1.5) && moddedDMG <= (tempdmgval * 2.4999999)) playweaksound = 1;
							if (moddedDMG >= (tempdmgval * 2.5) && moddedDMG <= (tempdmgval * 3.9999999)) playweaksound = 2;
							if (moddedDMG >= (tempdmgval * 4.0)) playweaksound = 3;
							//if (playweaksound > 0) victim.A_SetInventory("TookWeaknessHit",playweaksound);
							//else if (playweaksound < 0) victim.A_SetInventory("TookResistanceHit",(playweaksound*-1));
							if (dydudebug_hitsounds) Console.Printf("moddedDMG: %d (%.8f) (%s), playweaksound: %d, damagefactor: %.8f", moddedDMG, outputdmgfactor, mod, playweaksound, victim.damagefactor);
						}
					}
					if (dydudebug_hitsounds) Console.Printf("playweaksound: %d", playweaksound);

					string weakplayedsound = "";
					if (exex_hitweaksounds && victim.bISMONSTER && playweaksound != 0 && victim.CountInv("TempNoWeakSound") <= 0)
					{
						victim.A_SetInventory("TempNoWeakSound",1);
			
						if (playweaksound == -3) weakplayedsound = "Misc/ResistanceHitHigh";
						if (playweaksound == -2) weakplayedsound = "Misc/ResistanceHitMid";
						if (playweaksound == -1) weakplayedsound = "Misc/ResistanceHit";
						if (playweaksound == 1) weakplayedsound = "Misc/WeaknessHit";
						if (playweaksound == 2) weakplayedsound = "Misc/WeaknessHitMid";
						if (playweaksound == 3) weakplayedsound = "Misc/WeaknessHitHigh";
			
						if (initdmg > 0) makesound = true;
						//if (oldhealth > 0 && oldhealth > health) makesound = true;
						if (makesound)
						{
							if (source) 
							{
								if (dydudebug_hitsounds) Console.Printf("[weaksounds] source: %s", source.GetClassName());
								playpawn = PlayerPawn(source);
								if (victim.bFRIENDLY)
								{
									victim.A_StartSound(weakplayedsound, 11, CHANF_DEFAULT, (exex_hitweaksoundvol * frandom(0.75,1.25)), ATTN_NONE, 0.67);
								}
								else
								if (playpawn) 
								{
									if (dydudebug_hitsounds) Console.Printf("[weaksounds] playpawn: %s", playpawn.GetClassName());
									if (!victim.bFRIENDLY) victim.A_StartSound(weakplayedsound, 11, CHANF_DEFAULT, (exex_hitweaksoundvol * frandom(0.75,1.25)), ATTN_NONE, 1.0);
								}
								else
								{
									othermon = Actor(source);
									if (othermon) 
									{
										if (dydudebug_hitsounds) Console.Printf("[weaksounds] othermon: %s", othermon.GetClassName());
										if (othermon.bFRIENDLY && !victim.bFRIENDLY) victim.A_StartSound(weakplayedsound, 11, CHANF_DEFAULT, (exex_hitweaksoundvol * frandom(0.75,1.25)), ATTN_NONE, 1.5);
									}
								}
							}
						}
					}
				}

				bool playdthsounds = false;
				if (vict != "PracticeTarget" || vict != "PracticeTarget2" || vict != "BowlingPin" || vict != "OldPipe") playdthsounds = true;
				if (BossBrainNew(victim)) playdthsounds = true;
				nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) playdthsounds = false;
				if (BowlingPin(victim) || DDHoganTarget(victim) || OldPipe(victim)) playdthsounds = false;
				if (mod == 'SilentMassacre') playdthsounds = false;
				if (mod == 'GrowingPains') playdthsounds = false;
				
				if (playdthsounds)
				{
					if (victim.health <= 0 && exex_q3aqckillsounds2 && victim.bISMONSTER && (victim.bCOUNTKILL || specialtype || DDAFDNPC(victim)))
					{
						if (source || inflicter)
						{
							if (dydudebug_hitsounds && source) Console.Printf("[deathsound] source: %s", source.GetClassName());
							if (dydudebug_hitsounds && inflicter) Console.Printf("[deathsound] inflicter: %s", inflicter.GetClassName());
							if (source) playpawn = PlayerPawn(source);
							if (playpawn == null && inflicter) playpawn = PlayerPawn(inflicter);
							if (victim.bFRIENDLY)
							{
								if (dydudebug_hitsounds) Console.Printf("[deathsound] victim is friendly: %s", victim.GetClassName());
								if (DDAFDNPC(victim))
								{
									if (dydudebug_hitsounds) Console.Printf("[deathsound] victim is DDAFDNPC Type: %s", victim.GetClassName());
									playedsound = "misc/whoops";
									if (exex_q3aqchitsoundtype >= 0) 
									{
										victim.A_StopSound(12);
										victim.A_StartSound(playedsound, 12, CHANF_DEFAULT, (exex_q3aqckillsoundvol * frandom(0.75,1.25)), ATTN_NONE, frandom(0.80,0.888889));
									}
								}
								else
								{
									if (exex_q3aqckillsoundtype == 0) playedsound = "misc/killsndAlly";
									if (exex_q3aqckillsoundtype == 1) playedsound = "misc/killsndDEDAlly";
									if (exex_q3aqckillsoundtype >= 0) 
									{
										victim.A_StopSound(12);
										victim.A_StartSound(playedsound, 12, CHANF_DEFAULT, (exex_q3aqckillsoundvol * frandom(0.75,1.25)), ATTN_NONE);
									}
								}
							}
							else
							if (playpawn) 
							{
								if (dydudebug_hitsounds) Console.Printf("[deathsound] playpawn: %s", playpawn.GetClassName());
								if (DDAFDNPC(victim))
								{
									playedsound = "misc/whoops";
									if (exex_q3aqchitsoundtype >= 0) 
									{
										victim.A_StopSound(12);
										victim.A_StartSound(playedsound, 12, CHANF_DEFAULT, (exex_q3aqckillsoundvol * frandom(0.75,1.25)), ATTN_NONE, frandom(1.25,1.5));
									}
								}
								else
								if (!victim.bFRIENDLY)
								{
									if (exex_q3aqckillsoundtype == 0) playedsound = "misc/killsnd";
									if (exex_q3aqckillsoundtype == 1) playedsound = "misc/killsndDED";
									if (exex_q3aqckillsoundtype >= 0) 
									{
										victim.A_StopSound(12);
										victim.A_StartSound(playedsound, 12, CHANF_DEFAULT, (exex_q3aqckillsoundvol * frandom(0.75,1.25)), ATTN_NONE);
									}
								}
							}
							else
							{
								if (source) othermon = Actor(source);
								if (othermon == null && inflicter) othermon = Actor(inflicter);
								if (othermon) 
								{
									if (dydudebug_hitsounds) Console.Printf("[deathsound] othermon: %s", othermon.GetClassName());
									if (DDAFDNPC(victim))
									{
										playedsound = "misc/whoops";
										if (exex_q3aqchitsoundtype >= 0) 
										{
											victim.A_StopSound(12);
											victim.A_StartSound(playedsound, 12, CHANF_DEFAULT, (exex_q3aqckillsoundvol * frandom(0.75,1.25)), ATTN_NONE, frandom(0.80,0.888889));
										}
									}
									else
									if (othermon.bFRIENDLY && !victim.bFRIENDLY)
									{
										if (dydudebug_hitsounds) Console.Printf("[deathsound] othermon: %s kills %s (ally kills)", othermon.GetClassName(), victim.GetClassName());
										if (exex_q3aqckillsoundtype == 0) playedsound = "misc/killsnd2";
										if (exex_q3aqckillsoundtype == 1) playedsound = "misc/killsndDED2";
										if (exex_q3aqckillsoundtype >= 0) 
										{
											victim.A_StopSound(12);
											victim.A_StartSound(playedsound, 12, CHANF_DEFAULT, (exex_q3aqckillsoundvol * frandom(0.75,1.25)), ATTN_NONE);
										}
									}
									else
									if (!othermon.bFRIENDLY && !victim.bFRIENDLY && exex_hitsoundsmisc >= 0)
									{
										double rndpitch = frandom(0.334,1.0);
										if (random(1,2) <= 1 && rndpitch > 0.00) rndpitch = (1.00 / rndpitch);

										playedsound = "misc/killinfight"; //"misc/killsndduck";
										if (dydudebug_hitsounds) Console.Printf("[deathsound ('%s': %.8f)] othermon: %s kills %s (full infighting)", playedsound, rndpitch, othermon.GetClassName(), victim.GetClassName());
										victim.A_StopSound(12);
										victim.A_StartSound(playedsound, 12, CHANF_DEFAULT, (exex_q3aqckillsoundvol * frandompick(1.5,2.5)), ATTN_NONE, rndpitch);
									}
								}
							}
						}
					}
				}
				
				bool playdmgsounds = false;
				if (vict != "PracticeTarget" || vict != "PracticeTarget2" || vict != "BowlingPin" || vict != "OldPipe") playdmgsounds = true;
				if (BossBrainNew(victim)) playdmgsounds = true;
				if (BowlingPin(victim) || DDHoganTarget(victim) || OldPipe(victim)) playdmgsounds = false;
				nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) playdmgsounds = false;
				if (mod == 'SilentMassacre') playdmgsounds = false;
				if (mod == 'GrowingPains') playdmgsounds = false;
				
				if (playdmgsounds)
				{
					if (exex_q3aqchitsounds2 && victim.bISMONSTER && (victim.bCOUNTKILL || specialtype || DDAFDNPC(victim) || BossBrainNew(victim)) && victim.CountInv("TempNoHitSound") <= 0)
					{
						victim.A_SetInventory("TempNoHitSound",1);
						
						if (source || inflicter) 
						{
							if (dydudebug_hitsounds && source) Console.Printf("[hitsound] source: %s", source.GetClassName());
							if (dydudebug_hitsounds && inflicter) Console.Printf("[hitsound] inflicter: %s", inflicter.GetClassName());
							if (source) playpawn = PlayerPawn(source);
							if (playpawn == null && inflicter) playpawn = PlayerPawn(inflicter);
							if (victim.bFRIENDLY)
							{
								if (exex_q3aqchitsoundtype == 0) playedsound = "misc/hitally";
								if (exex_q3aqchitsoundtype == 1) playedsound = "misc/hitpally";
								if (exex_q3aqchitsoundtype >= 0) 
								{
									victim.A_StopSound(13);
									victim.A_StartSound(playedsound, 13, CHANF_DEFAULT, (exex_q3aqchitsoundvol * frandom(0.75,1.25)), ATTN_NONE);
								}
							}
							else
							if (playpawn) 
							{
								if (dydudebug_hitsounds) Console.Printf("[hitsound] playpawn: %s", playpawn.GetClassName());
								if (!victim.bFRIENDLY)
								{
									if (exex_q3aqchitsoundtype == 0) playedsound = "misc/hit";
									if (exex_q3aqchitsoundtype == 1) playedsound = "misc/hitpunch";
									if (exex_q3aqchitsoundtype >= 0) 
									{
										victim.A_StopSound(13);
										victim.A_StartSound(playedsound, 13, CHANF_DEFAULT, (exex_q3aqchitsoundvol * frandom(0.75,1.25)), ATTN_NONE);
									}
								}
							}
							else
							{
								if (source) othermon = Actor(source);
								if (othermon == null && inflicter) othermon = Actor(inflicter);
								if (othermon) 
								{
									if (dydudebug_hitsounds) Console.Printf("[hitsound] othermon: %s", othermon.GetClassName());
									if (othermon.bFRIENDLY && !victim.bFRIENDLY)
									{
										if (exex_q3aqchitsoundtype == 0) playedsound = "misc/hit2";
										if (exex_q3aqchitsoundtype == 1) playedsound = "misc/hitpunch2";
										if (exex_q3aqchitsoundtype >= 0) 
										{
											victim.A_StopSound(13);
											victim.A_StartSound(playedsound, 13, CHANF_DEFAULT, (exex_q3aqchitsoundvol * frandom(0.75,1.25)), ATTN_NONE);
										}
									}
									else
									if (!othermon.bFRIENDLY && !victim.bFRIENDLY && exex_hitsoundsmisc >= 0)
									{
										double rndpitch = frandom(0.50,1.00);
										if (random(1,2) <= 1 && rndpitch > 0.00) rndpitch = (1.00 / rndpitch);

										if (random(1,2) <= 1) playedsound = "misc/hitmine2";
																		 else playedsound = "misc/hitmine";
										victim.A_StopSound(13);
										victim.A_StartSound(playedsound, 13, CHANF_DEFAULT, (exex_hitsoundsvol * frandompick(0.75,1.25)), ATTN_NONE, rndpitch);
									}
								}
							}
						}
					}
				}
			}
			
			// Adding in Argv's SingleDamageRipper code :V
			if (inflicter is "SingleDamageRipper")
			{
				SingleDamageRipper(inflicter).ActorsAlreadyHit.Push(victim);
				SingleDamageRipper(inflicter).timesrippedoverall++;
				if (SingleDamageRipper(inflicter).timesrippedoverall < 0) SingleDamageFastRipper(inflicter).timesrippedoverall = 0;
			}

			if (inflicter is "SingleDamageFastRipper")
			{
				SingleDamageFastRipper(inflicter).ActorsAlreadyHit.Push(victim);
				SingleDamageFastRipper(inflicter).timesrippedoverall++;
				if (SingleDamageFastRipper(inflicter).timesrippedoverall < 0) SingleDamageFastRipper(inflicter).timesrippedoverall = 0;
			}
		}
		Super.WorldThingDamaged(e);
	}
	
	int, int, actor, actor, actor, actor, actor, int, int, bool, bool A_KillDropTables(int PLuck, int TrueLuck, actor victim, actor inflicter, actor source, actor mastor, actor IPAttack, int specialtype, int monsterrating, bool playerkill, bool allykill)
	{
		actor player = players[0].mo;
		let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
		if (inflicter && inflicter.target) source = inflicter.target;
		if (inflicter && inflicter.master) mastor = inflicter.master;
		string vict = "NONE";
		string infl = "NONE";
		string sour = "NONE";
		string mast = "NONE";
		if (victim) vict = victim.GetClassName();
		if (inflicter) infl = inflicter.GetClassName();
		if (source) sour = source.GetClassName();
		if (mastor) mast = mastor.GetClassName();
		let globalvars = DDGlobalVariables.Get();
		int TruePlayerLevel = 0;
		if (exex_expenabled && MiscItem) TruePlayerLevel = MiscItem.PlayerLevel;
		int user_type;
		
		class<Actor> extracheck, extracheck2, extracheck3, extracheck4;
		string nm, nn, no, np;
		
		int Kills = Player.CountInv("KillsCount");
		// Drop Tables
		string dropname;
		int baseIPLuckMul = frandompick(1.5,1.5,1.5,1.5,1.5,2.0);
		int baseIPLvlDivider = frandompick(0.8,0.925,0.925,0.925,0.925,0.925);
		int baseIPBaseChanceMul = frandompick(0.8,0.925,0.925,0.925,0.925,0.925);
		int basedropdiv;
		double luckbase;
		int droptimes;
		int lvldivider;
		int basechance;
		int maxchance;
		int scraprolls;
		bool candropitems = false;
		if (specialtype) candropitems = true;
		if (!victim.bFRIENDLY && (victim.bCOUNTKILL || specialtype)) candropitems = true;
		if (PracticeTarget(victim) || 
				PracticeTarget2(victim) || 
				DDAFDNPC(victim) || 
				BowlingPin(victim) || 
				DDMiniTank(victim) || 
				DDHoganTarget(victim) || 
				OldPipe(victim)) candropitems = false;
		nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) candropitems = false;
		nm = "ClayDevilNew"; extracheck = nm; if (vict == extracheck) candropitems = false;
		//Console.Printf("candropitems: %d", candropitems);
		if (!playerkill || !allykill)
		{
			if (random(1,64) <= 1) candropitems = true;
												else candropitems = false;
		}
		if (candropitems)
		{
			droptimes = 1;
			if (monsterrating == 1) droptimes = randompick(1,1,1,1,2);
			if (monsterrating == 2) droptimes = randompick(1,1,1,2,2);
			if (monsterrating == 3) droptimes = randompick(1,1,2,2,2);
			if (monsterrating == 4) droptimes = randompick(1,2,2,2,2);
			if (monsterrating == 5) droptimes = randompick(2,2,2,2,3);
			if (monsterrating == 6) droptimes = randompick(2,2,2,3,3);
			if (monsterrating == 7) droptimes = randompick(2,2,3,3,3);
			if (monsterrating >= 8) droptimes = randompick(2,3,3,3,4);
			luckbase = 0.0625 + (monsterrating * 0.015625);
			lvldivider = 35;
			if (IPAttack) 
			{
				luckbase *= baseIPLuckMul;
				lvldivider *= baseIPLvlDivider;
			}
			if (PLuck) droptimes = floor(droptimes + (TrueLuck * frandompick((luckbase*0),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase),(luckbase*2),(luckbase*2))));
			if (inflicter && ((source && DDPlayerPawn(source))))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			else
			if (inflicter && DDPlayerPawn(inflicter))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			if (victim.bBOSS) droptimes *= 4;
			for (int i; i < droptimes; i++)
			{
				// Specific Drops from Specific Monsters
				let monsterp = Actor(victim);
				
				// Doom Monsters
				basedropdiv = 256;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 16;
				luckbase = 0.25;
				if (IPAttack) 
				{
					basedropdiv *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basedropdiv -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				// Add Specific Monsters Below :V
				if (monsterp = Zombieman(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = ZombiemanNew(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = ShotgunGuy(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = ShotgunGuyNew(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = ChaingunGuy(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = ChaingunGuyNew(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = WolfensteinSS(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = WolfensteinSSNew(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("RadSuit2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = HellKnight(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("BerserkNew",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,(basedropdiv*0.25)) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				else
				if (monsterp = HellKnightNew(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("BerserkNew",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,(basedropdiv*0.25)) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				else
				if (monsterp = BaronOfHell(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("BerserkNew",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,(basedropdiv*0.125)) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				else
				if (monsterp = BaronOfHellNew(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("BerserkNew",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,(basedropdiv*0.125)) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = Cacodemon(victim))
				{
					if (random(1,basedropdiv) <= random(2,3)) victim.A_SpawnItemEx("DoubleSphere",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = CacodemonNew(victim))
				{
					if (random(1,basedropdiv) <= random(2,3)) victim.A_SpawnItemEx("DoubleSphere",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = Demon(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("GuardSphere",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = DemonNew(victim))
				{
					if (random(1,basedropdiv) <= 1) victim.A_SpawnItemEx("GuardSphere",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = Archvile(victim))
				{
					if (random(1,basedropdiv) <= random(4,5)) victim.A_SpawnItemEx("HasteSphere",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				if (monsterp = ArchvileNew(victim))
				{
					if (random(1,basedropdiv) <= random(4,5)) victim.A_SpawnItemEx("HasteSphere",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
				
				
				// Heretic Monsters
				basedropdiv = 256;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 16;
				luckbase = 0.25;
				if (IPAttack) 
				{
					basedropdiv *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basedropdiv -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				// Add Specific Monsters Below :V
				
				
				// Hexen Monsters
				basedropdiv = 256;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 16;
				luckbase = 0.25;
				if (IPAttack) 
				{
					basedropdiv *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basedropdiv -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				// Add Specific Monsters Below :V
				if (monsterp = FireDemon(victim))
				{
					if (random(1,basedropdiv) <= 8) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 1) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = Ettin(victim))
				{
					if (random(1,basedropdiv) <= 32) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 4) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = Centaur(victim))
				{
					if (random(1,basedropdiv) <= 24) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 3) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = CentaurLeader(victim))
				{
					if (random(1,basedropdiv) <= 48) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 6) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = Serpent(victim))
				{
					if (random(1,basedropdiv) <= 32) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 4) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = SerpentLeader(victim))
				{
					if (random(1,basedropdiv) <= 48) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 6) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = Bishop(victim))
				{
					if (random(1,basedropdiv) <= 16) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 2) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = Wraith(victim))
				{
					if (random(1,basedropdiv) <= 24) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 3) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = Demon1(victim))
				{
					if (random(1,basedropdiv) <= 32) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 4) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = Demon2(victim))
				{
					if (random(1,basedropdiv) <= 32) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 4) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				if (monsterp = IceGuy(victim))
				{
					if (random(1,basedropdiv) <= 80) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					if (random(1,basedropdiv) <= 10) 
					{
						user_type = random(1,4);
						if (user_type == 1) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 2) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 3) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						if (user_type == 4) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
				}
				
				
				// Strife Monsters
				basedropdiv = 256;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 16;
				luckbase = 0.25;
				if (IPAttack) 
				{
					basedropdiv *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basedropdiv -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				// Add Specific Monsters Below :V
			}
			
			// Ammo/Weapons
			string droptype;
			droptimes = 1;
			if (monsterrating == 1) droptimes = randompick(1,1,1,1,2);
			if (monsterrating == 2) droptimes = randompick(1,1,1,2,2);
			if (monsterrating == 3) droptimes = randompick(1,1,2,2,2);
			if (monsterrating == 4) droptimes = randompick(1,2,2,2,2);
			if (monsterrating == 5) droptimes = randompick(2,2,2,2,3);
			if (monsterrating == 6) droptimes = randompick(2,2,2,3,3);
			if (monsterrating == 7) droptimes = randompick(2,2,3,3,3);
			if (monsterrating >= 8) droptimes = randompick(2,3,3,3,4);
			luckbase = 0.0625 + (monsterrating * 0.015625);
			lvldivider = 50;
			if (IPAttack) 
			{
				luckbase *= baseIPLuckMul;
				lvldivider *= baseIPLvlDivider;
			}
			if (PLuck) droptimes = floor(droptimes + (TrueLuck * frandompick((luckbase*0),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase),(luckbase*2),(luckbase*2))));
			if (inflicter && ((source && DDPlayerPawn(source))))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			else
			if (inflicter && DDPlayerPawn(inflicter))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			if (victim.bBOSS) droptimes *= 4;
			for (int i; i < droptimes; i++)
			{
				basechance = exex_inventorydroprate6;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 16;
				luckbase = 0.25;
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = randompick((basechance * 0.75),(basechance * 0.875),(basechance),(basechance * 1.125),(basechance * 1.25));
				if (RecordShot(inflicter)) maxchance = randompick((basechance * 1.5),(basechance * 1.75),(basechance * 2),(basechance * 2.25),(basechance * 2.5));
				if (VacPuff(inflicter)) maxchance = (basechance * 16);
				if (random(1,maxchance) <= 1) // Main Drop Chance
				{
					int temp = 1;
					let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
					if (MiscItem) temp = (1 + (TrueLuck * 0.08334));
					if (random(1,16) <= temp) // Weapons
					{
						user_type = random(1,8);
						int temp2 = random(1,16);
						if (temp2 >= 1 && temp2 <= 2) user_type = random(1,11);
						if (temp2 >= 3 && temp2 <= 5) user_type = random(1,10);
						if (temp2 >= 6 && temp2 <= 10) user_type = random(1,9);
						if (temp2 >= 11 && temp2 <= 16) user_type = random(1,8);
						droptype = "ItemSatchel";
						if (random(1,32) <= 1) droptype = "MegaSatchel";
						if (user_type == 1) 
						{
							droptype = "CricketBat";
							if (player.CountInv(droptype)) 
							{
								droptype = "ItemSatchel";
								if (random(1,32) <= 1) droptype = "MegaSatchel";
								double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
								double raredropsndvol = frandom(1.75,2.25);
								int raredropsndchannel = randompick(191,192,222,223,264,265);
								victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
							}
						}
						if (user_type == 2) 
						{
							droptype = "AppleJack";
							if (player.CountInv(droptype)) 
							{
								droptype = "ItemSatchel";
								if (random(1,32) <= 1) droptype = "MegaSatchel";
								double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
								double raredropsndvol = frandom(1.75,2.25);
								int raredropsndchannel = randompick(191,192,222,223,264,265);
								victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
							}
						}
						if (user_type == 3) 
						{
							droptype = "BlunderAxe";
							if (player.CountInv(droptype)) 
							{
								if (random(1,64) <= 1 && player.CountInv("BlunderShotUpgrade") < 3) droptype = "BlunderAxeSchematic";
								else
								{
									droptype = "ItemSatchel";
									if (random(1,32) <= 1) droptype = "MegaSatchel";
								}
							}
							double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
							double raredropsndvol = frandom(1.75,2.25);
							int raredropsndchannel = randompick(191,192,222,223,264,265);
							victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
						}
						if (user_type == 4) 
						{
							droptype = "CandleWhip";
							if (player.CountInv(droptype)) 
							{
								droptype = "ItemSatchel";
								if (random(1,32) <= 1) droptype = "MegaSatchel";
								double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
								double raredropsndvol = frandom(1.75,2.25);
								int raredropsndchannel = randompick(191,192,222,223,264,265);
								victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
							}
						}
						if (user_type == 5) 
						{
							droptype = "Scrambler";
							if (player.CountInv(droptype)) 
							{
								droptype = "ItemSatchel";
								if (random(1,32) <= 1) droptype = "MegaSatchel";
								double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
								double raredropsndvol = frandom(1.75,2.25);
								int raredropsndchannel = randompick(191,192,222,223,264,265);
								victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
							}
						}
						if (user_type == 6) 
						{
							droptype = "WizardPike";
							if (player.CountInv(droptype)) 
							{
								droptype = "ItemSatchel";
								if (random(1,32) <= 1) droptype = "MegaSatchel";
								double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
								double raredropsndvol = frandom(1.75,2.25);
								int raredropsndchannel = randompick(191,192,222,223,264,265);
								victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
							}
						}
						if (user_type == 7) 
						{
							droptype = "Grimophone";
							if (player.CountInv(droptype)) 
							{
								if (random(1,64) <= 1 && player.CountInv("GrimophoneUpgrade") < 3)
								{
									droptype = "GrimophoneMicrochip";
									double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
									double raredropsndvol = frandom(1.75,2.25);
									int raredropsndchannel = randompick(191,192,222,223,264,265);
									victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
								}
								else
								{
									droptype = "ItemSatchel";
									if (random(1,32) <= 1) droptype = "MegaSatchel";
									double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
									double raredropsndvol = frandom(1.75,2.25);
									int raredropsndchannel = randompick(191,192,222,223,264,265);
									victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
								}
							}
						}
						if (user_type == 8)
						{
							droptype = "SuperVac";
							if (player.CountInv(droptype)) 
							{
								droptype = "ItemSatchel";
								if (random(1,32) <= 1) droptype = "MegaSatchel";
								double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
								double raredropsndvol = frandom(1.75,2.25);
								int raredropsndchannel = randompick(191,192,222,223,264,265);
								victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
							}
						}
						if (user_type == 9)
						{
							droptype = "CrazyBallDD";
						}
						if (user_type == 10) 
						{
							droptype = "SigilPickup";
							if (player.CountInv("SigilPieces") >= 5)
							{
								droptype = "ItemSatchel";
								if (random(1,32) <= 1) droptype = "MegaSatchel";
							}
							double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
							double raredropsndvol = frandom(1.75,2.25);
							int raredropsndchannel = randompick(191,192,222,223,264,265);
							victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
						}
						if (user_type == 11) 
						{
							droptype = "FosnianCandle";
							if (player.CountInv(droptype)) droptype = "FCandleAmmo";
							double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
							double raredropsndvol = frandom(1.75,2.25);
							int raredropsndchannel = randompick(191,192,222,223,264,265);
							victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
						}
						
						if (droptype == "ItemSatchel" && random(1,128) <= 1)
						{
							droptype = "PortalSatchel";
							double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
							double raredropsndvol = frandom(1.75,2.25);
							int raredropsndchannel = randompick(191,192,222,223,264,265);
							victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
						}
						if (droptype == "MegaSatchel" && random(1,32) <= 1) droptype = "PortalSatchel";
						victim.A_SpawnItemEx(droptype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					}
					else // Ammo
					{
						int temp = 48;
						let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
						if (MiscItem) temp = (48 + (TrueLuck * 0.25));
						if (random(1,256) <= temp) 
						{
							user_type = random(1,8);
							if (user_type == 1) victim.A_SpawnItemEx("MalletAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 2) victim.A_SpawnItemEx("JackAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 4) victim.A_SpawnItemEx("CandleAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 5) victim.A_SpawnItemEx("EggAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 6) victim.A_SpawnItemEx("PikeAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 7) victim.A_SpawnItemEx("MusicAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 8) victim.A_SpawnItemEx("VacAmmoBig",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						}
						else
						{
							user_type = random(1,8);
							if (user_type == 1) victim.A_SpawnItemEx("MalletAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 2) victim.A_SpawnItemEx("JackAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 3) victim.A_SpawnItemEx("BlunderAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 4) victim.A_SpawnItemEx("CandleAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 5) victim.A_SpawnItemEx("EggAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 6) victim.A_SpawnItemEx("PikeAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 7) victim.A_SpawnItemEx("MusicAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (user_type == 8) victim.A_SpawnItemEx("VacAmmo",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
						}
					}
				}
			}
			
			// Heal Items
			droptimes = 1;
			if (monsterrating == 1) droptimes = randompick(1,1,1,1,2);
			if (monsterrating == 2) droptimes = randompick(1,1,1,2,2);
			if (monsterrating == 3) droptimes = randompick(1,1,2,2,2);
			if (monsterrating == 4) droptimes = randompick(1,2,2,2,2);
			if (monsterrating == 5) droptimes = randompick(2,2,2,2,3);
			if (monsterrating == 6) droptimes = randompick(2,2,2,3,3);
			if (monsterrating == 7) droptimes = randompick(2,2,3,3,3);
			if (monsterrating >= 8) droptimes = randompick(2,3,3,3,4);
			luckbase = 0.0625 + (monsterrating * 0.015625);
			lvldivider = 35;
			if (IPAttack) 
			{
				luckbase *= baseIPLuckMul;
				lvldivider *= baseIPLvlDivider;
			}
			if (PLuck) droptimes = floor(droptimes + (TrueLuck * frandompick((luckbase*0),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase),(luckbase*2),(luckbase*2))));
			if (inflicter && ((source && DDPlayerPawn(source))))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			else
			if (inflicter && DDPlayerPawn(inflicter))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			if (victim.bBOSS) droptimes *= 8;
			for (int i; i < droptimes; i++)
			{
				basechance = exex_inventorydroprate7;
				luckbase = 0.5;
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = randompick((basechance * 0.75),(basechance * 0.875),(basechance),(basechance * 1.125),(basechance * 1.25));
				if (RecordShot(inflicter)) maxchance = randompick((basechance * 1.5),(basechance * 1.75),(basechance * 2),(basechance * 2.25),(basechance * 2.5));
				if (VacPuff(inflicter)) maxchance = (basechance * 16);
				if (random(1,(maxchance)) == 1) victim.A_SpawnItemEx("GalaApple",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,(maxchance)) == 1) victim.A_SpawnItemEx("FoodPlateFruit",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,(maxchance*2)) == 1) victim.A_SpawnItemEx("AppleWine",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,(maxchance*4)) == 1) victim.A_SpawnItemEx("TurkeyDinner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,(maxchance*4)) == 1) victim.A_SpawnItemEx("PigRoastDishExtra",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,(maxchance*4)) == 1) victim.A_SpawnItemEx("Berserk",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (dydudebug_worlddiedmonsterdrops) Console.Printf("maxchance [heal]: %d (%d)", maxchance, basechance);
			}

			droptimes = 1;
			if (monsterrating == 1) droptimes = randompick(1,1,1,1,2);
			if (monsterrating == 2) droptimes = randompick(1,1,1,2,2);
			if (monsterrating == 3) droptimes = randompick(1,1,2,2,2);
			if (monsterrating == 4) droptimes = randompick(1,2,2,2,2);
			if (monsterrating == 5) droptimes = randompick(2,2,2,2,3);
			if (monsterrating == 6) droptimes = randompick(2,2,2,3,3);
			if (monsterrating == 7) droptimes = randompick(2,2,3,3,3);
			if (monsterrating >= 8) droptimes = randompick(2,3,3,3,4);
			luckbase = 0.0625 + (monsterrating * 0.015625);
			lvldivider = 70;
			if (IPAttack) 
			{
				luckbase *= baseIPLuckMul;
				lvldivider *= baseIPLvlDivider;
			}
			if (PLuck) droptimes = floor(droptimes + (TrueLuck * frandompick((luckbase*0),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase),(luckbase*2),(luckbase*2))));
			if (inflicter && ((source && DDPlayerPawn(source))))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			else
			if (inflicter && DDPlayerPawn(inflicter))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			if (victim.bBOSS) droptimes *= 4;
			for (int i; i < droptimes; i++)
			{
				// Armor Items
				basechance = exex_inventorydroprate8;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 2;
				luckbase = 1.0;
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = (basechance * 16);
				if (RecordShot(inflicter)) maxchance = (basechance * 4);
				if (VacPuff(inflicter)) maxchance = (basechance * 8);
				if (dydudebug_worlddiedmonsterdrops) Console.Printf("maxchance [armor]: %d (%d)", maxchance, basechance);
				if (random(1,maxchance) <= 1)
				{
					double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
					double raredropsndvol = frandom(1.75,2.25);
					int raredropsndchannel = randompick(191,192,222,223,264,265);
					victim.A_StartSound("rareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					//Full Armor Drops
					user_type = random(1,100);
					if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls"))
					{
						if (user_type >= 1 && user_type <= 90) { victim.A_SpawnItemEx("KnightGown",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
						else if (user_type >= 91 && user_type <= 96) { victim.A_SpawnItemEx("KnightGown2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
						else if (user_type >= 97 && user_type <= 98) { victim.A_SpawnItemEx("KnightGown3",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
						else if (user_type >= 99) { victim.A_SpawnItemEx("KnightGown4",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
					}
					else
					{
						if (user_type >= 1 && user_type <= 67) { victim.A_SpawnItemEx("KnightGown",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
						else if (user_type >= 68 && user_type <= 89) { victim.A_SpawnItemEx("KnightGown2",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
						else if (user_type >= 90 && user_type <= 98) { victim.A_SpawnItemEx("KnightGown3",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
						else if (user_type >= 99) { victim.A_SpawnItemEx("KnightGown4",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION); }
					}
				}
				else
				{
					scraprolls = 1;
					if (BlunderPuff(inflicter)) 
					{
						scraprolls += randompick(0,0,0,0,0,1,1,1,1,1,1,1,2,2,3);
						if (random(1,32) <= (6 + ((TruePlayerLevel * 0.015))))
						{
							if (Zombieman(victim) || ZombiemanNew(victim)) scraprolls += randompick(1,1,2,2);
							if (ShotgunGuy(victim) || ShotgunGuyNew(victim)) scraprolls += randompick(1,2,2,2);
							if (ChaingunGuy(victim) || ChaingunGuyNew(victim)) scraprolls += randompick(2,2,3,3);
							if (DoomImp(victim) || DoomImpNew(victim)) scraprolls += randompick(0,0,1,1);
							if (Demon(victim) || DemonNew(victim)) scraprolls += randompick(1,2,2,3);
							if (Cacodemon(victim) || CacodemonNew(victim)) scraprolls += randompick(2,2,2,3);
							if (BaronOfHell(victim) || BaronOfHellNew(victim)) scraprolls += randompick(1,2,2,3);
							if (HellKnight(victim) || HellKnightNew(victim)) scraprolls += randompick(1,2,2,3);
							if (PainElemental(victim) || PainElementalNew(victim)) scraprolls += randompick(2,2,2,3);
							if (LostSoul(victim) || LostSoulNew(victim)) scraprolls += randompick(0,0,0,1);
							if (Revenant(victim) || RevenantNew(victim)) scraprolls += randompick(1,1,1,2);
							if (Arachnotron(victim) || ArachnotronNew(victim) || RailArachnotron(victim)) scraprolls += randompick(2,2,2,3);
							if (Fatso(victim) || MancubusNew(victim)) scraprolls += randompick(1,1,1,2);
							if (Cyberdemon(victim) || CyberdemonNew(victim)) scraprolls += randompick(3,3,4,4);
							if (SpiderMastermind(victim) || SpiderMastermindNew(victim)) scraprolls += randompick(5,5,5,6);
							
							if (Knight(victim)) scraprolls += randompick(1,2,2,3);
							if (IronLich(victim)) scraprolls += randompick(9,9,10,10);
							if (Minotaur(victim)) scraprolls += randompick(3,3,4,4);
							if (Beast(victim)) scraprolls += randompick(2,2,2,3);
							if (Clink(victim)) scraprolls += randompick(2,2,3,3);
							if (Snake(victim)) scraprolls += randompick(1,2,2,3);
							
							if (Ettin(victim)) scraprolls += randompick(1,2,2,3);
							if (Centaur(victim)) scraprolls += randompick(2,2,2,3);
							if (CentaurLeader(victim)) scraprolls += randompick(0,0,1,1);
							if (Demon1(victim)) scraprolls += randompick(1,1,1,2);
							if (Demon2(victim)) scraprolls += randompick(1,1,1,2);
							if (Serpent(victim)) scraprolls += randompick(1,1,1,2);
							if (SerpentLeader(victim)) scraprolls += randompick(0,0,1,1);
							if (FighterBoss(victim)) scraprolls += randompick(5,5,5,6);
							if (ClericBoss(victim)) scraprolls += randompick(3,3,3,4);
							if (MageBoss(victim)) scraprolls += randompick(1,1,1,2);
						}
					}
					if (RecordShot(inflicter)) scraprolls += randompick(0,0,0,1,1,1,1,1,2,2,2);
					if (VacPuff(inflicter)) scraprolls += (randompick(0,0,0,0,1,1,1,1,2,2,2) - 2);
					//Scrap Drops
					if (scraprolls > 0)
					{
						int baseval = randompick(2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3);
						for (int i = 0; i < scraprolls; i++)
						{
							string armortype = "ArmorScrap";
							if (random(1,1024) <= 1) armortype = "ArmorScrapKit";
							if (BlunderPuff(inflicter) && i == 0) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (random(1,1024) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
							if (random(1,(baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (random(1,1024) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
							if (random(1,(baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (random(1,1024) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
							if (random(1,(baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (random(1,1024) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
							if (random(1,(baseval*baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (random(1,1024) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
							if (random(1,(baseval*baseval*baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (random(1,1024) <= 1) armortype = "ArmorScrapKit"; else armortype = "ArmorScrap";
							if (random(1,(baseval*baseval*baseval*baseval*baseval*baseval)) == 1) victim.A_SpawnItemEx(armortype,frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
							if (dydudebug_worlddiedmonsterdrops) Console.Printf("ScrapRolls: %d / %d", i, scraprolls);
						}
					}
				}
			}
			
			// Cup of Rage Drops [Level and Kills Dependant Drop]
			int killmod1 = randompick(50,75,75,75,75,75,75,75,75,100);
			if (MiscItem)
			{
				if (TruePlayerLevel >= 125) randompick(5,10,10,10,10,10,10,10,10,25);
				if (TruePlayerLevel >= random(62,63)) randompick(10,25,25,25,25,25,25,25,25,50);
				if (TruePlayerLevel >= 25) randompick(25,50,50,50,50,50,50,50,50,75);
				if (TruePlayerLevel >= 0) randompick(50,75,75,75,75,75,75,75,75,100);
			}
			int killmod2 = int(killmod1 * 0.5);
			if (kills % killmod1 == killmod2) 
			{
				victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,8) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,32) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,128) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				if (random(1,512) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
			}
			else
			{
				int basechance = 1;
				if (MiscItem)
				{
					if (TruePlayerLevel >= 125) basechance = 7;
					if (TruePlayerLevel >= random(62,63)) basechance = 4;
					if (TruePlayerLevel >= 25) basechance = 2;
					if (TruePlayerLevel >= 0) basechance = 1;
				}
				if (random(1,100) <= basechance)
				{
					victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,8) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,32) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,128) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
					if (random(1,512) <= 1) victim.A_SpawnItemEx("CupOfRageSpawner",frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),frandom(-2,2),SXF_NOCHECKPOSITION);
				}
			}

			// Random Inventory Item Drops
			droptimes = 1;
			if (monsterrating == 1) droptimes = randompick(1,1,1,1,2);
			if (monsterrating == 2) droptimes = randompick(1,1,1,2,2);
			if (monsterrating == 3) droptimes = randompick(1,1,2,2,2);
			if (monsterrating == 4) droptimes = randompick(1,2,2,2,2);
			if (monsterrating == 5) droptimes = randompick(2,2,2,2,3);
			if (monsterrating == 6) droptimes = randompick(2,2,2,3,3);
			if (monsterrating == 7) droptimes = randompick(2,2,3,3,3);
			if (monsterrating >= 8) droptimes = randompick(2,3,3,3,4);
			luckbase = 0.0625 + (monsterrating * 0.015625);
			lvldivider = 70;
			if (IPAttack) 
			{
				luckbase *= baseIPLuckMul;
				lvldivider *= baseIPLvlDivider;
			}
			if (PLuck) droptimes = floor(droptimes + (TrueLuck * frandompick((luckbase*0),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase),(luckbase*2),(luckbase*2))));
			if (inflicter && ((source && DDPlayerPawn(source))))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			else
			if (inflicter && DDPlayerPawn(inflicter))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem && TruePlayerLevel >= lvldivider) droptimes += (TruePlayerLevel / lvldivider);
			}
			if (victim.bBOSS) droptimes *= 4;
			for (int i; i < droptimes; i++)
			{
				// Primary
				basechance = exex_inventorydroprate1;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 8;
				luckbase = 0.0625; // (512)
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = randompick((basechance * 0.75),(basechance * 0.875),(basechance),(basechance * 1.125),(basechance * 1.25));
				if (RecordShot(inflicter)) maxchance = randompick((basechance * 1.5),(basechance * 1.75),(basechance * 2),(basechance * 2.25),(basechance * 2.5));
				if (VacPuff(inflicter)) maxchance = (basechance * 16);
				if (dydudebug_worlddiedmonsterdrops) Console.Printf("maxchance [primaryinv]: %d (%d)", maxchance, basechance);
				if (random(1,maxchance) <= 1)
				{
					double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
					double raredropsndvol = frandom(1.75,2.25);
					int raredropsndchannel = randompick(191,192,222,223,264,265);
					victim.A_StartSound("misc/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					user_type = random(1,128);
					if (user_type >= 1 && user_type <= 40) { victim.A_SpawnItemEx("CherryBombPickup",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); }
					if (user_type >= 41 && user_type <= 70) { victim.A_SpawnItemEx("SpinnerPickup",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); }
					if (user_type >= 71 && user_type <= 92) { victim.A_SpawnItemEx("BRocketPickup",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); }
					if (user_type >= 93 && user_type <= 112) { victim.A_SpawnItemEx("PopperPickup",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); }
					if (user_type >= 113 && user_type <= 126) { victim.A_SpawnItemEx("SnakePickup",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); }
					if (user_type >= 127 && user_type <= 128) { victim.A_SpawnItemEx("KilletanteEffigy",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); }
				}

				// Secondary
				basechance = exex_inventorydroprate2;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 8;
				luckbase = 0.5; // (512)
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = randompick((basechance * 0.75),(basechance * 0.875),(basechance),(basechance * 1.125),(basechance * 1.25));
				if (RecordShot(inflicter)) maxchance = randompick((basechance * 1.5),(basechance * 1.75),(basechance * 2),(basechance * 2.25),(basechance * 2.5));
				if (VacPuff(inflicter)) maxchance = (basechance * 16);
				if (dydudebug_worlddiedmonsterdrops) Console.Printf("maxchance [secondaryinv]: %d (%d)", maxchance, basechance);
				if (random(1,maxchance) <= 1)
				{
					user_type = random(1,353);
					if (user_type >= 1 && user_type <= 140) 
					{
						victim.A_SpawnItemEx("FuryPotion",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); 
						double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
						double raredropsndvol = frandom(1.75,2.25);
						int raredropsndchannel = randompick(191,192,222,223,264,265);
						victim.A_StartSound("rareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					}
					if (user_type >= 141 && user_type <= 256)
					{
						victim.A_SpawnItemEx("CrazyBallDD",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
						double raredropsndvol = frandom(1.75,2.25);
						int raredropsndchannel = randompick(191,192,222,223,264,265);
						victim.A_StartSound("rareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					}
					if (user_type >= 257 && user_type <= 320) 
					{
						victim.A_SpawnItemEx("TimePotion",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); 
						double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
						double raredropsndvol = frandom(1.75,2.25);
						int raredropsndchannel = randompick(191,192,222,223,264,265);
						victim.A_StartSound("rareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					}
					if (user_type >= 321 && user_type <= 336) 
					{
						victim.A_SpawnItemEx("BirdPotion",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); 
						double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
						double raredropsndvol = frandom(1.75,2.25);
						int raredropsndchannel = randompick(191,192,222,223,264,265);
						victim.A_StartSound("rareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					}
					if (user_type >= 337 && user_type <= 352) 
					{
						victim.A_SpawnItemEx("BlunderAxeSchematic",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
						double raredropsndvol = frandom(1.75,2.25);
						int raredropsndchannel = randompick(191,192,222,223,264,265);
						victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					}
					if (user_type >= 353 && user_type <= 368) 
					{
						victim.A_SpawnItemEx("GrimophoneMicrochip",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
						double raredropsndvol = frandom(1.75,2.25);
						int raredropsndchannel = randompick(191,192,222,223,264,265);
						victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					}
					if (user_type >= 369) 
					{
						victim.A_SpawnItemEx("DoorBell",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION); 
						double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
						double raredropsndvol = frandom(1.75,2.25);
						int raredropsndchannel = randompick(191,192,222,223,264,265);
						victim.A_StartSound("ultrarareitem/spawn",raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					}
				}

				// Rare Powerup Drop
				basechance = exex_inventorydroprate3;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 8;
				luckbase = 2.00; // (512) 
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = randompick((basechance * 0.75),(basechance * 0.875),(basechance),(basechance * 1.125),(basechance * 1.25));
				if (RecordShot(inflicter)) maxchance = randompick((basechance * 1.5),(basechance * 1.75),(basechance * 2),(basechance * 2.25),(basechance * 2.5));
				if (VacPuff(inflicter)) maxchance = (basechance * 16);
				if (dydudebug_worlddiedmonsterdrops) Console.Printf("maxchance [secondaryinv]: %d (%d)", maxchance, basechance);
				if (random(1,maxchance) <= 1)
				{
					double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
					double raredropsndvol = frandom(1.75,2.25);
					int raredropsndchannel = randompick(191,192,222,223,264,265);
					string raredropsndname = "rareitem/spawn";
					victim.A_StartSound(raredropsndname,raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
					if (gameinfo.gametype & 1) // Doom Mode
					{
						user_type = random(1,20);
						if (user_type >= 1 && user_type <= 6) victim.A_SpawnItemEx("BlurSphere",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 7 && user_type <= 12) victim.A_SpawnItemEx("Infrared",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 13 && user_type <= 18) victim.A_SpawnItemEx("RadSuit",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 19) victim.A_SpawnItemEx("InvulnerabilitySphere",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
					}
					if (gameinfo.gametype & 2) // Heretic Mode
					{
						user_type = random(1,20);
						if (user_type >= 1 && user_type <= 6) victim.A_SpawnItemEx("ArtiInvisibility",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 7 && user_type <= 12) victim.A_SpawnItemEx("ArtiTomeOfPower",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 13 && user_type <= 18) victim.A_SpawnItemEx("BerserkSphere",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 19) victim.A_SpawnItemEx("ArtiInvulnerability",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
					}
					if (gameinfo.gametype & 4) // Hexen Mode
					{
						user_type = random(1,20);
						if (user_type >= 1 && user_type <= 6) victim.A_SpawnItemEx("TimePotion",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 7 && user_type <= 12) victim.A_SpawnItemEx("PortalSatchel",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 13 && user_type <= 18) victim.A_SpawnItemEx("BerserkSphere",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 19) victim.A_SpawnItemEx("ArtiInvulnerability2",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
					}
					if (gameinfo.gametype & 8) // Strife Mode
					{
					}
				}

				// Type 4
				basechance = exex_inventorydroprate4;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 8;
				luckbase = 0.25; // (512)
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = randompick((basechance * 0.75),(basechance * 0.875),(basechance),(basechance * 1.125),(basechance * 1.25));
				if (RecordShot(inflicter)) maxchance = randompick((basechance * 1.5),(basechance * 1.75),(basechance * 2),(basechance * 2.25),(basechance * 2.5));
				if (VacPuff(inflicter)) maxchance = (basechance * 16);
				if (dydudebug_worlddiedmonsterdrops) Console.Printf("maxchance [secondaryinv]: %d (%d)", maxchance, basechance);
				if (random(1,maxchance) <= 1 && victim.waterlevel >= 3)
				{
					double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
					double raredropsndvol = frandom(1.75,2.25);
					int raredropsndchannel = randompick(191,192,222,223,264,265);
					string raredropsndname = "rareitem/spawn";
					victim.A_SpawnItemEx("DivingHelm",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
					victim.A_StartSound(raredropsndname,raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);
				}

				// Extremely Rare Drops
				basechance = exex_inventorydroprate5;
				if (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls")) basechance *= 8;
				luckbase = 3.0; // (682.66667)
				if (IPAttack) 
				{
					basechance *= baseIPBaseChanceMul;
					luckbase *= baseIPLuckMul;
				}
				if (PLuck) basechance -= (TrueLuck * frandompick((luckbase*0),(luckbase*0.25),(luckbase*0.25),(luckbase*0.25),(luckbase*0.5),(luckbase*0.5),(luckbase*0.5),(luckbase),(luckbase),(luckbase*2)));
				maxchance = basechance;
				if (BatPuff(inflicter)) maxchance = (basechance * 0.5);
				if (ApplePuff(inflicter)) maxchance = randompick((basechance * 0.375),(basechance * 0.4375),(basechance * 0.5),(basechance * 0.5625),(basechance * 0.625));
				if (BlunderPuff(inflicter)) maxchance = randompick((basechance * 0.75),(basechance * 0.875),(basechance),(basechance * 1.125),(basechance * 1.25));
				if (RecordShot(inflicter)) maxchance = randompick((basechance * 1.5),(basechance * 1.75),(basechance * 2),(basechance * 2.25),(basechance * 2.5));
				if (VacPuff(inflicter)) maxchance = (basechance * 16);
				if (dydudebug_worlddiedmonsterdrops) Console.Printf("maxchance [extremerare]: %d (%d)", maxchance, basechance);
				if (random(1,maxchance) <= 1)
				{
					double raredropsndpitch = frandompick(0.75,0.875,1.0,1.125,1.25);
					double raredropsndvol = frandom(1.75,2.25);
					int raredropsndchannel = randompick(193,194,224,225,266,267);
					string raredropsndname = "ultrarareitem/spawn";
					victim.A_StartSound(raredropsndname,raredropsndchannel,CHANF_OVERLAP|CHANF_NOPAUSE,raredropsndvol,ATTN_NONE,raredropsndpitch);

					if (exex_extraatkdefspd)
					{
						user_type = random(1,100);
						if (user_type >= 1 && user_type <= 34) victim.A_SpawnItemEx("GoldApple",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 35 && user_type <= 39) victim.A_SpawnItemEx("PlatinumApple",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type == 40) victim.A_SpawnItemEx("PrismaApple",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 41 && user_type <= 60) victim.A_SpawnItemEx("AfasDrop",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 61 && user_type <= 80) victim.A_SpawnItemEx("LegendaryMedicine",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 81 && user_type <= 100) victim.A_SpawnItemEx("SigilPickup",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
					}
					else
					{
						user_type = random(1,100);
						if (user_type >= 1 && user_type <= 40) victim.A_SpawnItemEx("GoldApple",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 39 && user_type <= 48) victim.A_SpawnItemEx("PlatinumApple",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 49 && user_type <= 50) victim.A_SpawnItemEx("PrismaApple",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 51 && user_type <= 75) victim.A_SpawnItemEx("LegendaryMedicine",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
						if (user_type >= 76 && user_type <= 100) victim.A_SpawnItemEx("SigilPickup",0.0,0.0,0.0,0.0,0.0,0.0,SXF_NOCHECKPOSITION);
					}
				}
				
				//
				if (vict == "KilletanteSoloist")
				{
					dropname = "GalaApple";
					if (random(1,2) == 1) dropname = "AppleWine";
					victim.A_SpawnItemEx(dropname,frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),SXF_NOCHECKPOSITION);
					if (random(1,2) == 1)
					{
						dropname = "GalaApple";
						if (random(1,2) == 1) dropname = "AppleWine";
						victim.A_SpawnItemEx(dropname,frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),SXF_NOCHECKPOSITION);
						
						if (random(1,4) == 1)
						{
							dropname = "GalaApple";
							if (random(1,2) == 1) dropname = "AppleWine";
							victim.A_SpawnItemEx(dropname,frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),SXF_NOCHECKPOSITION);
							
							if (random(1,8) == 1)
							{
								dropname = "GalaApple";
								if (random(1,2) == 1) dropname = "AppleWine";
								victim.A_SpawnItemEx(dropname,frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),SXF_NOCHECKPOSITION);
							}
						}
					}
				}
			}
		}
		
		// Special Actor Conditions
		if (vict == "ZBell")
		{
			int typesdrop = 1;
			if ((victim.Stamina <= 0) || (victim.Stamina <= 2 && ((inflicter && (BatPuff(inflicter))))))
			{
				victim.Stamina++;
				if (inflicter && (BatPuff(inflicter))) typesdrop = random(2,5);
				
				for (int i = 0; i < typesdrop; i++)
				{
					user_type = random(1,2);
					//Console.Printf("#1: %d", user_type);
					if (user_type == 1) // Weapons
					{
						user_type = random(1,29);
						//Console.Printf("#2a: %d", user_type);
						if (user_type >= 1 && user_type <= 4) dropname = "CricketBat";
						if (user_type >= 5 && user_type <= 8) dropname = "AppleJack";
						if (user_type >= 9 && user_type <= 12) dropname = "BlunderAxe";
						if (user_type >= 13 && user_type <= 16) dropname = "Scrambler";
						if (user_type >= 17 && user_type <= 20) dropname = "WizardPike";
						if (user_type >= 21 && user_type <= 24) dropname = "SuperVac";
						if (user_type >= 24 && user_type <= 28) dropname = "CandleWhip";
						if (user_type == 29) dropname = "Grimophone";
					}
					else
					if (user_type == 2) // Health
					{
						user_type = random(1,29);
						//Console.Printf("#2b: %d", user_type);
						if (user_type >= 1 && user_type <= 12) dropname = "GalaApple";
						if (user_type >= 13 && user_type <= 18) dropname = "FoodPlateFruit";
						if (user_type >= 19 && user_type <= 22) dropname = "AppleWine";
						if (user_type >= 23 && user_type <= 25) dropname = "PigRoastDish";
						if (user_type >= 26 && user_type <= 28) dropname = "TurkeyDinner";
						if (user_type == 29) dropname = "GourmetMeal";
					}
					victim.A_SpawnItemEx(dropname,frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),frandom(-5,5),SXF_NOCHECKPOSITION);
				}
			}
		}
		
		// Mapset Specific Things
		nm = "Balloon_Black"; extracheck = nm; 
		if (vict == extracheck)
		{
		}
		nm = "Balloon"; extracheck = nm; 
		nn = "BallTarg"; extracheck2 = nn; 
		no = "Balloon_Red"; extracheck3 = no; 
		np = "Balloon_Red2"; extracheck4 = np; 
		if (vict == extracheck || vict == extracheck2 || vict == extracheck3 || vict == extracheck4)
		{
		}
		nm = "Balloon_Yellow"; extracheck = nm; 
		nn = "BallYel"; extracheck2 = nn; 
		if (vict == extracheck || vict == extracheck2)
		{
		}
		nm = "Balloon_Green"; extracheck = nm; 
		nn = "BallGreen"; extracheck2 = nn; 
		if (vict == extracheck || vict == extracheck2)
		{
		}
		nm = "Balloon_Blue"; extracheck = nm; 
		if (vict == extracheck)
		{
		}
		
		return PLuck, TrueLuck, victim, inflicter, source, mastor, IPAttack, specialtype, monsterrating, playerkill, allykill;
	}
	
	override void WorldThingDied(WorldEvent e)
	{
		if (Level.MapName != "TITLEMAP")
		{
			actor player = players[0].mo;
			let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
			actor victim = e.Thing;
			actor inflicter = e.inflictor;
			actor source;
			actor mastor;
			if (inflicter && inflicter.target) source = inflicter.target;
			if (inflicter && inflicter.master) mastor = inflicter.master;
			string vict = "NONE";
			string infl = "NONE";
			string sour = "NONE";
			string mast = "NONE";
			if (victim) vict = victim.GetClassName();
			if (inflicter) infl = inflicter.GetClassName();
			if (source) sour = source.GetClassName();
			if (mastor) mast = mastor.GetClassName();
			int PLuck;
			int TrueLuck;
			let globalvars = DDGlobalVariables.Get();
			int TruePlayerLevel = 0;
			if (exex_expenabled && MiscItem) TruePlayerLevel = MiscItem.PlayerLevel;
			int user_type;
			bool giveexp;
			bool playerkill;
			bool allykill;

			if (MiscItem)
			{
				PLuck = MiscItem.PlayerLUCK;
				if (skill <= 0) TrueLuck = random((PLuck*0.75),PLuck);
				if (skill == 1) TrueLuck = random((PLuck*0.625),PLuck);
				if (skill == 2) TrueLuck = random((PLuck*0.5),PLuck);
				if (skill == 3) TrueLuck = random((PLuck*0.375),PLuck);
				if (skill >= 4) TrueLuck = random((PLuck*0.25),PLuck);
				TrueLuck *= exex_pluckfactor;
			}
			if (dydudebug_worlddied) Console.Printf("[%s] WorldThingDied", vict);
			
			class<Actor> extracheck, extracheck2, extracheck3, extracheck4;
			string nm, nn, no, np;
			
			if (victim && !BowlingPin(victim) && !EECustomGib(victim) && !OldPipe(victim) && !DDMiniTank(victim) && !DDHoganTarget(victim))
			{
				int specialtype;
				nm = "CCardGhostMarker";
				if (victim.CountInv(nm)) specialtype += 1;
				nm = "CCardAssassinMarker";
				if (victim.CountInv(nm)) specialtype += 2;
				nm = "CCardRespawnedMarker";
				if (victim.CountInv(nm)) specialtype += 4;
				if (dydudebug_worlddied) Console.Printf("[%s] SpecialType [WorldDied]: %d", vict, specialtype);

				actor IPAttack;
				if (!(DDPlayerPawn(victim)) || (victim.bCOUNTKILL || specialtype))
				{
					int monsterrating = victim.CountInv("MonsterRating");
					if (!victim.CountInv("DedMonsterFlag") && !sv_monsterrespawn) victim.A_SetInventory("DedMonsterFlag",1);
					
					if (dydudebug_worlddied) Console.Printf("\c[purple]Attack: %s, \c[brick]Attacker: %s", infl, sour);
					if ((victim.bCOUNTKILL || specialtype) && !victim.bFRIENDLY && inflicter)
					{
						if (inflicter) 
						{
							if (PlayerPawn(inflicter)) playerkill = true;
							if (inflicter.bFRIENDLY) allykill = true;
							if (inflicter.bFRIENDLY || DDPlayerPawn(inflicter))
							{
								if (IPAttack == null) IPAttack = EEProjectile(inflicter);
								giveexp = true;
							}
							//Console.Printf("inflictor: %s [%d]", infl, inflicter.bFRIENDLY);
						}
						if (source) 
						{
							if (PlayerPawn(source)) playerkill = true;
							if (source.bFRIENDLY) allykill = true;
							if (source.bFRIENDLY || DDPlayerPawn(source)) 
							{
								if (IPAttack == null) IPAttack = EEProjectile(source);
								giveexp = true;
							}
							//Console.Printf("inflictor.target: %s [%d]", sour, source.bFRIENDLY);
						}
						if (mastor) 
						{
							if (PlayerPawn(mastor)) playerkill = true;
							if (mastor.bFRIENDLY) allykill = true;
							if (IPAttack == null) IPAttack = EEProjectile(mastor);
							if (mastor.bFRIENDLY || DDPlayerPawn(mastor)) giveexp = true;
							//Console.Printf("mastor: %s [%d]", mast, mastor.bFRIENDLY);
						}
						if (EvilWarriorShieldBall(inflicter) && playerkill && MiscItem)
						{
							MiscItem.EWShieldKills++;
							//Console.Printf("MiscItem.EWShieldKills: %d [inflicter]", MiscItem.EWShieldKills);
						}
						nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) giveexp = false;
						
						int ExpGain = (victim.spawnhealth() + victim.Stamina);
						if (monsterrating)
						{
							if (monsterrating == 1) ExpGain *= 1.0125;
							if (monsterrating == 2) ExpGain *= 1.025;
							if (monsterrating == 3) ExpGain *= 1.05;
							if (monsterrating == 4) ExpGain *= 1.1;
							if (monsterrating == 5) ExpGain *= 1.2;
							if (monsterrating == 6) ExpGain *= 1.4;
							if (monsterrating == 7) ExpGain *= 1.8;
							if (monsterrating >= 8) ExpGain *= 2.6;
						}
						if (specialtype & 1) ExpGain *= 0.5;
						if (specialtype & 2) ExpGain *= frandompick(1.8,2.2);
						if (specialtype & 4) ExpGain *= frandompick(0.625,0.875);
						if ((source && source.CountInv("DinahTrueIPState")) || (inflicter && inflicter.CountInv("DinahTrueIPState"))) ExpGain *= 0.2;
						if (VacPuff(inflicter)) ExpGain *= frandompick(0.125,0.1667,0.1667,0.2,0.2,0.2,0.25,0.25,0.25,0.25,0.3,0.3,0.3,0.3334,0.3334,0.375);
						if (vict == "EvilDinah")
						{
							if (IPAttack) ExpGain *= frandom(1.75,3.0);
											 else ExpGain *= frandom(1.20,1.875);
						}
						else
						{
							if (IPAttack) ExpGain *= frandom(0.125,0.25);
											 else ExpGain *= frandom(0.05,0.125);
						}

						if ((source && source.bFRIENDLY) || (inflicter && inflicter.bFRIENDLY) || (mastor && mastor.bFRIENDLY)) ExpGain *= frandom(0.65,0.90);
						if (DDPlayerPawn(source) && infl == "PlayerWhistle") ExpGain *= frandom(1.1875,1.3125);
						if (vict == "KilletanteSoloist") ExpGain *= frandom(3.5,4.0);
						if (DDOrigBoss(victim)) ExpGain *= frandom(5.25,6.0);
						If (PLuck)
						{
							int PLevel = Player.CountInv("PlayerLevel");
									 if (PLevel <= 11) ExpGain *= (1.00 + (TrueLuck * frandompick(0,0.00125,0.00125,0.0025,0.0025,0.0025,0.005,0.005,0.005,0.01,0.01,0.02)));
							else if (PLevel <= 26) ExpGain *= (1.00 + (TrueLuck * frandompick(0.00125,0.00125,0.0025,0.0025,0.0025,0.005,0.005,0.005,0.01,0.01,0.01,0.02,0.02)));
							else if (PLevel <= 66) ExpGain *= (1.00 + (TrueLuck * frandompick(0.00125,0.0025,0.0025,0.0025,0.005,0.005,0.005,0.01,0.01,0.02,0.02,0.02,0.04)));
							else if (PLevel <= 101) ExpGain *= (1.00 + (TrueLuck * frandompick(0.0025,0.0025,0.0025,0.005,0.005,0.005,0.01,0.01,0.02,0.02,0.02,0.04,0.04)));
							else if (PLevel <= 201) ExpGain *= (1.00 + (TrueLuck * frandompick(0.0025,0.0025,0.005,0.005,0.005,0.01,0.01,0.02,0.02,0.02,0.04,0.04,0.04)));
						}
						if (MiscItem)
						{
							double tallyextra;
							tallyextra = (MiscItem.totalallkills * 0.005) + (MiscItem.totalallitems * 0.0025) + (MiscItem.totalallsecrets * 0.0025) + (MiscItem.totalcompleted * 0.01);
							ExpGain *= (1.00 + tallyextra);
							if (dydudebug_worlddied) Console.Printf("x%.4f", 1.00+tallyextra);
						}
						EXPGain *= exex_expmultiplier;
						
						if (giveexp && exex_expenabled && Level.MapName != "TITLEMAP")
						{
							if (ExpGain < 1) ExpGain = 1;

							let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
							if (MiscItem && MiscItem.NumOfAfasDrops) 
							{
								ExpGain *= (1.0 + (MiscItem.NumOfAfasDrops * 0.0625));
								if (DDPlayerPawn(source) && infl == "PlayerWhistle")
								{
									ExpGain += (MiscItem.NumOfAfasDrops * randompick(1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3) * frandom(2.0,2.5));
								}
								else
								{
									ExpGain += MiscItem.NumOfAfasDrops * randompick(1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3);
								}
							}
							
							Actor player = players[0].mo;
							if (player.health > 0 || !player.CountInv("PlayerIsDead"))
							{
								int EXPPrevReq = 0;
								if (MiscItem.PlayerLevel > 0) EXPPrevReq = MiscItem.LevelExpRequirement[(MiscItem.PlayerLevel-1)];
								int EXPCurrReq = MiscItem.LevelExpRequirement[(MiscItem.PlayerLevel)];
								int EXPFullReq = (EXPCurrReq-EXPPrevReq);
								//Console.Printf("%d / %d (%d)", EXPPrevReq, EXPCurrReq, EXPFullReq);
								Player.A_GiveInventory("KillsCount",1);
								Player.A_GiveInventory("ExpPts",ExpGain);
								int Kills = Player.CountInv("KillsCount");
								int ExpNew = Player.CountInv("ExpPts");
								int ExpNeeded = Player.CountInv("ExpPtsNeeded");
								int PlayerLevel = Player.CountInv("PlayerLevel");
								if (exex_showexpgains) Console.Printf("\c[green]+%d EXP! \c[darkgreen][Have: %d / %d (Lvl: %d)] \c[red](Kills: %d)", ExpGain, ExpNew, ExpNeeded, PlayerLevel, Kills);
								if (exex_showexpgains)
								{
									MiscItem.KillComboCount += 1;
									MiscItem.EXPGainHUDAmt += ExpGain;
									if (MiscItem.EXPGainHUDTimer <= 0) MiscItem.EXPGainHUDTimer = 105;
									else
									{
										MiscItem.EXPGainHUDTimer += 35;
										if (MiscItem.EXPGainHUDTimer < 105 && ExpGain > (EXPFullReq * 0.05)) MiscItem.EXPGainHUDTimer = 105;
										if (MiscItem.EXPGainHUDTimer < 175 && ExpGain > (EXPFullReq * 0.10)) MiscItem.EXPGainHUDTimer = 175;
										if (MiscItem.EXPGainHUDTimer < 245 && ExpGain > (EXPFullReq * 0.25)) MiscItem.EXPGainHUDTimer = 245;
										if (MiscItem.EXPGainHUDTimer > 280) MiscItem.EXPGainHUDTimer = 280;
									}
								}
							}
						}
						else
						{
							Actor player = players[0].mo;
							if (player.health > 0 || !player.CountInv("PlayerIsDead"))
							{
								Player.A_GiveInventory("KillsCount",1);
								int Kills = Player.CountInv("KillsCount");
							}
						}
						
						// BUILD-style oneliner for kills [optional]
						bool playoneliner = false;
						if (inflicter == player || source == player || mastor == player) playoneliner = true;
						if (PracticeTarget(victim) || 
								PracticeTarget2(victim) || 
								BowlingPin(victim) || 
								DDAFDNPC(victim) || 
								DDMiniTank(victim) || 
								DDHoganTarget(victim) || 
								OldPipe(victim)) playoneliner = false;
						nm = "PennywiseToy1"; extracheck = nm; if (vict == extracheck) playoneliner = false;
						
						if (playoneliner && player.GetClassName() == "DinahPlayer" && MiscItem)
						{
							if (dydudebug_worlddied) Console.Printf("Voice Check");
							if (exex_dinahextravoices && exex_dinahoneliners && !MiscItem.OneLinerCooldown)
							{
								int basechance = exex_dinahonelinerbasechance; // 8
								if (basechance < 0) basechance = 0;
								if (basechance > 0)
								{
									if (MiscItem) basechance += (MiscItem.ItemPoints * (basechance * 0.01));
									if (IPAttack) basechance *= frandompick(1.125,1.167,1.25,1.334);
									if (player.CountInv("DecentHealth")) basechance *= 1.25;
									if (player.CountInv("LowHealth")) basechance *= 1.5;
									if (player.CountInv("CriticalHealth")) basechance *= 1.875;
									if (MiscItem)
									{
										if (MiscItem.WineDefTier == 1 || MiscItem.WineDefTier == -1) basechance *= 1.125;
										if (MiscItem.WineDefTier == 2 || MiscItem.WineDefTier == -2) basechance *= 1.375;
										if (MiscItem.WineDefTier == 3 || MiscItem.WineDefTier == -3) basechance *= 1.75;
										if (MiscItem.WineDefTier == 4 || MiscItem.WineDefTier == -4) basechance *= 2.5;
										if (MiscItem.WineDefTier == 5 || MiscItem.WineDefTier == -5) basechance *= 4.0;
									}
									if (infl == "FistPuff" || infl == "UppercutPuff" || infl == "KickPuff" || infl == "KickPuffNoThrust") basechance *= frandompick(3.5,4,4.5);
									if (BatPuff(inflicter)) basechance *= frandompick(2.25,2.5,2.75);
									if (ApplePuff(inflicter)) basechance *= frandompick(2.25,2.5,2.75);
									if (BlunderPuff(inflicter)) basechance *= frandompick(2.25,2.5,2.75);
									if (WhipPuff(inflicter)) basechance *= frandompick(2.25,2.5,2.75);
									if (VacPuff(inflicter)) basechance *= frandompick(1.125,1.25,1.375);
									if (victim.bBOSS) basechance *= 8;
									if (player.CountInv("PowerStrength") || player.CountInv("PowerStrengthDD")) basechance *= frandompick(1.25,1.25,1.25,1.5,1.5,2);
									if (dydudebug_worlddied) Console.Printf("%d / 256", basechance);
									if (random(1,256) <= basechance && (MiscItem && MiscItem.CanTalkUnderwater))
									{
										double maskpitch = 1.00;
										if (player.waterlevel >= 3 && MiscItem.CanTalkUnderwater >= 2) maskpitch *= 1.259921885;
										string voicenm;
										double voicevol = frandom(1.25,1.75);
										if (player.CountInv("PowerStrength") || player.CountInv("PowerStrengthDD")) voicevol *= frandompick(1.125,1.125,1.125,1.25,1.25,1.5);
										int randvoice = random(1,17);
										if (randvoice == 1) 
										{
											voicenm = "Dinah/didthathurt";
											Console.Printf("\c[gold]'Did that hurt?!'\c-");
										}
										if (randvoice == 2) 
										{
											voicenm = "Dinah/ithinknot";
											Console.Printf("\c[gold]'I think not!'\c-");
										}
										if (randvoice == 3) 
										{
											voicenm = "Dinah/nownow";
											Console.Printf("\c[gold]'Now now...'\c-");
										}
										if (randvoice == 4) 
										{
											voicenm = "Dinah/thatleaveamark";
											Console.Printf("\c[gold]'That will leave a mark!'\c-");
										}
										if (randvoice == 5) 
										{
											voicenm = "Dinah/howsavage";
											Console.Printf("\c[gold]'How savage!'\c-");
										}
										if (randvoice == 6) 
										{
											voicenm = "Dinah/Gotcha";
											Console.Printf("\c[gold]'GOTCHA!'\c-");
										}
										if (randvoice == 7)
										{
											voicenm = "Dinah/IWinG";
											Console.Printf("\c[gold]'I WIN!'\c-");
										}
										if (randvoice == 8)
										{
											voicenm = "Dinah/BitOfALetdown";
											Console.Printf("\c[gold]'A bit of a let-down...'\c-");
										}
										if (randvoice == 9)
										{
											voicenm = "Dinah/NahAhAh";
											Console.Printf("\c[gold]'Nah-ah-ah!'\c-");
										}
										if (randvoice == 10)
										{
											voicenm = "Dinah/OverSoSoon";
											Console.Printf("\c[gold]'Over so soon!?'\c-");
										}
										if (randvoice == 11)
										{
											voicenm = "Dinah/HowRude";
											Console.Printf("\c[gold]'How rude!'\c-");
										}
										if (randvoice == 12)
										{
											voicenm = "dinah/OhWell";
											Console.Printf("\c[gold]'Oh well...!' *shrugs*\c-");
										}
										if (randvoice == 13)
										{
											voicenm = "dinah/ThatsAShame";
											Console.Printf("\c[gold]'That's a Shame...!'\c-");
										}
										if (randvoice == 14)
										{
											voicenm = "dinah/OhMy";
											Console.Printf("\c[gold]'Oh my...!'\c-");
										}
										if (randvoice == 15)
										{
											voicenm = "dinah/YourMine";
											Console.Printf("\c[gold]'You're Mine!!'\c-");
										}
										if (randvoice == 16)
										{
											voicenm = "dinah/TakeCareT";
											Console.Printf("\c[gold](sarcastically) 'Take care!'\c-");
										}
										if (randvoice == 17)
										{
											voicenm = "dinah/NoEscape";
											Console.Printf("\c[gold]'No escape!!'\c-");
										}
										player.A_StopSound(CHAN_VOICE);
										player.A_StartSound(voicenm,CHAN_VOICE,CHANF_DEFAULT,voicevol,ATTN_NORM,maskpitch); 
										MiscItem.OneLinerCooldown += (frandom(1.75,3.0) * TICRATE);
									}
								}
							}
						}
					}
					
					// Item Drop Action
					[PLuck, TrueLuck, victim, inflicter, source, mastor, IPAttack, specialtype, monsterrating, playerkill, allykill] = A_KillDropTables(PLuck, TrueLuck, victim, inflicter, source, mastor, IPAttack, specialtype, monsterrating, playerkill, allykill);
					
					//*******************************
					//* Killed With Certain Weapons *
					//*******************************
					if (inflicter && DDPlayerPawn(source) && (victim.bCOUNTKILL || specialtype))
					{
						if (VacPuff(inflicter))
						{
							bool erase = true;
							int vactype = 0;
							if (DeathIncarnate(victim)) erase = false; // Death Incarnates CANNOT be erased by the Vac. Nopity Nope Nope! V:
							if (erase)
							{
								if (DDOrigCreature(victim))
								{
									if (ddafd_originalsupervacamts && (player.CountInv("IsDynDuchess") || player.CountInv("IsAppetite") || player.CountInv("IsCarnOfSouls"))) vactype = 1;
									if (vactype == 1)
									{
										if (Hammerduck(victim) ||
												Planter(victim) ||
												Manchineel(victim) ||
												Manchineel_Ceiling(victim) ||
												Centaurion(victim) ||
												PuddingDog(victim) ||
												PuddingPup(victim) ||
												Vitriola(victim) ||
												Killetante(victim) ||
												KilletanteSoloist(victim) ||
												Muddernaut(victim) ||
												Jugger(victim) ||
												Juggette(victim) ||
												ReelHeel(victim) ||
												SpiderCenser(victim) ||
												Galgoyle(victim) ||
												KnuckleHead(victim) ||
												Shillfish(victim) ||
												Bellefish(victim) ||
												Nurse(victim) ||
												FractalChicken(victim) ||
												FractalChick(victim) ||
												FractalHen(victim) ||
												CremeDeBratte(victim) ||
												CremeDeBratte_Torched(victim) ||
												Reaper(victim) ||
												Devil(victim) ||
												PushyAngel(victim) ||
												PushyArchAngel(victim) ||
												Forsaken(victim) ||
												Forsaken_Quisling(victim) ||
												Forsaken_Jorgensen(victim)) vactype = 1; else vactype = 0;
									}
								}
								let IPPuff = EEProjectile(inflicter);
								int vacgive;
								if (vactype == 1)
								{
									if (Hammerduck(victim)) vacgive = 3;
									if (Planter(victim)) vacgive = 4;
									if (Manchineel(victim)) vacgive = 6;
									if (Manchineel_Ceiling(victim)) vacgive = 6;
									if (Centaurion(victim)) vacgive = 6;
									if (PuddingDog(victim)) vacgive = 6;
									if (PuddingPup(victim)) vacgive = 1;
									if (Vitriola(victim)) vacgive = 4;
									if (Killetante(victim)) vacgive = 4;
									if (KilletanteSoloist(victim)) vacgive = 5;
									if (Muddernaut(victim)) vacgive = 12;
									if (Jugger(victim)) vacgive = 12;
									if (Juggette(victim)) vacgive = 6;
									if (ReelHeel(victim)) vacgive = 4;
									if (SpiderCenser(victim)) vacgive = 4;
									if (Galgoyle(victim)) vacgive = 4;
									if (KnuckleHead(victim)) vacgive = 12;
									if (Shillfish(victim)) vacgive = 6;
									if (Bellefish(victim)) vacgive = 2;
									if (Nurse(victim)) vacgive = 4;
									if (FractalChicken(victim)) vacgive = 4;
									if (FractalChick(victim)) vacgive = 1;
									if (FractalHen(victim)) vacgive = 12;
									if (CremeDeBratte(victim)) vacgive = 4;
									if (CremeDeBratte_Torched(victim)) vacgive = 4;
									if (Reaper(victim)) vacgive = 4;
									if (Devil(victim)) vacgive = 12;
									if (PushyAngel(victim)) vacgive = 12;
									if (PushyArchAngel(victim)) vacgive = 60;
									if (Forsaken(victim)) vacgive = 3;
									if (Forsaken_Quisling(victim)) vacgive = 3;
									if (Forsaken_Jorgensen(victim)) vacgive = 3;
									if (MiscItem) vacgive *= MiscItem.SuperVacBagSize;
								}
								else
								if (vactype <= 0)
								{
									vacgive = victim.spawnhealth() + victim.Stamina;
									if (Shillfish(victim)) vacgive *= 8;
									vacgive *= frandompick(0.6667,0.8334,1.000,1.1667,1.3334);
									if (IPPuff) vacgive *= frandompick(0.75,0.75,0.75,0.75,0.875); 
												 else vacgive *= 0.5;
									
									nm = "ClayDevilNew"; extracheck = nm;
									if (vict == extracheck) vacgive *= 8;
								}
								source.A_GiveInventory("VacAmmoCounter",vacgive);
								source.A_StartSound("VacDed",210,CHANF_DEFAULT,frandom(0.75,0.90),ATTN_NORM,frandom(1.8,2.7));
								if (vict == "CommanderKeen") victim.A_KeenDie(); // I forgot to consider Keens use a different "death action" than the other monsters. >.>
								victim.A_BossDeath(); // Makes sure certain monsters do their hardcoded E1M8/MAP07 type effects on death
								if (vict == "Korax" || vict == "KoraxNew") ACS_Execute(255, 0); // Ensures Korax calls Script 255 is he's somehow absorbed by the Vac [though he should be unable to be killed by it :P]
								let SubEntity = EntitySecond(victim);
								if (SubEntity) SubEntity.A_SubEntityDeath(); // makes sure Strife's game ends once all SubEntities die. V:

								nm = "ArchangelusA"; extracheck = nm;
								nn = "ArchangelusB"; extracheck2 = nn;
								if (vict == extracheck) victim.A_SpawnItemEx(extracheck2, 8, 0, 0, 0, 0, 0, 0.0, SXF_NOCHECKPOSITION);
								if (vict == extracheck2) victim.A_BrainDie();
								victim.A_StopSound(CHAN_VOICE);
								victim.A_FadeOut(1.0,FTF_REMOVE);

								Console.Printf("+%d Vacuum Bag Units", vacgive);
							}
						}
					}
					
					EECreature BossVict;
					BossVict = EECreature(victim);
					if (BossVict) 
					{
						if (dydudebug_scriptdisplays) Console.Printf("BossVict");
						BossVict.bossdeathactivate++;
					}
				}
			}
		}
		Super.WorldThingDied(e);
	}
	
	override void WorldLoaded(WorldEvent e)
	{
		if (dydudebug_checksumprintout) Console.Printf("\cyMapCheckSum:\cx %s", level.GetChecksum());
		actor player = players[0].mo;
		let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
		let globalvars = DDGlobalVariables.Get();
		bool BatGuardCheck = true;
		int levelnums = level.levelnum;
		if (e.IsSaveGame) BatGuardCheck = false;
		
		// DynMus Reset
		if (MiscItem)
		{
			if (MiscItem.DynMusFightTimer > 0 || MiscItem.DynMusCalmTimer > 0 || MiscItem.DynMusActCall || MiscItem.randmusroll > -1) 
			{
				MiscItem.DynMusActCall = false;
				MiscItem.DynMusFightTimer = -1;
				MiscItem.DynMusCalmTimer = -1;
				MiscItem.randmusroll = -1;
				MiscItem.playeractiontimer = 0;
				MiscItem.playeractiontimerfrag = 0;
			}
		}
		
		if (!e.IsReopen)
		{
			bool addmapcounttrue = true;
			for (int i = 0; i <= globalvars.MapsFinished; i++)
			{
				if (globalvars.MapNum[i] == levelnums) 
				{
					addmapcounttrue = false;
					break;
				}
			}
			// Check for certain MAPs that are more of intermission maps [PSX Doom TC's "D[#]END". KDIZD'S "INTERMAP", etc]
			if (addmapcounttrue)
			{
				let IsPSXDoom = PlayingPSXDoom(player.FindInventory("PlayingPSXDoom"));
				if (IsPSXDoom)
				{
					if (dydudebug_mapfinishcheck) Console.Printf("\c[orange]Playing PSX Doom");
					if (level.GetChecksum() == '95d8e4afa07a7e3330997a6aa5d0318d') addmapcounttrue = false;
					if (level.GetChecksum() == '17e16b88bf7f163f05a6a5c45f0dfeb6') addmapcounttrue = false;
					if (level.GetChecksum() == '39f6b93101248e39ae1af7c751647ea1') addmapcounttrue = false;
					if (level.GetChecksum() == '058234c82963c80b99a58081f829dead') addmapcounttrue = false;
					if (level.GetChecksum() == '77e33d393cb8386a13fe74391e053cd6') addmapcounttrue = false;
					if (level.GetChecksum() == '7364394e3b113aea8490d8b0b89c7e05') addmapcounttrue = false;
				}
				if (!addmapcounttrue)
				{
					if (dydudebug_mapfinishcheck) Console.Printf("\c[brick]IS AN INTERMISSION MAP (do not add to the queue)");
				}
			}
			if (addmapcounttrue)
			{
				globalvars.MapsFinished++;
				globalvars.MapNum.push(globalvars.MapsFinished);
				globalvars.MapNum[globalvars.MapsFinished] = level.levelnum;
				globalvars.NumKills.push(globalvars.MapsFinished);
				globalvars.MaxKills.push(globalvars.MapsFinished);
				globalvars.AllKills.push(globalvars.MapsFinished);
				globalvars.AllKills[globalvars.MapsFinished] = false;
				globalvars.AllKillsSound.push(globalvars.MapsFinished);
				globalvars.AllKillsSound[globalvars.MapsFinished] = false;
				globalvars.AllKillsTimer.push(globalvars.MapsFinished);
				globalvars.AllKillsTimer[globalvars.MapsFinished];
				
				globalvars.NumItems.push(globalvars.MapsFinished);
				globalvars.MaxItems.push(globalvars.MapsFinished);
				globalvars.AllItems.push(globalvars.MapsFinished);
				globalvars.AllItems[globalvars.MapsFinished] = false;
				globalvars.AllItemsSound.push(globalvars.MapsFinished);
				globalvars.AllItemsSound[globalvars.MapsFinished] = false;
				globalvars.AllItemsTimer.push(globalvars.MapsFinished);
				globalvars.AllItemsTimer[globalvars.MapsFinished];
				
				globalvars.NumSecrets.push(globalvars.MapsFinished);
				globalvars.MaxSecrets.push(globalvars.MapsFinished);
				globalvars.AllSecrets.push(globalvars.MapsFinished);
				globalvars.AllSecrets[globalvars.MapsFinished] = false;
				globalvars.AllSecretsSound.push(globalvars.MapsFinished);
				globalvars.AllSecretsSound[globalvars.MapsFinished] = false;
				globalvars.AllSecretsTimer.push(globalvars.MapsFinished);
				globalvars.AllSecretsTimer[globalvars.MapsFinished];
				
				globalvars.AllCompletion.push(globalvars.MapsFinished);
				globalvars.AllCompletion[globalvars.MapsFinished] = false;
				globalvars.AllCompletionSound.push(globalvars.MapsFinished);
				globalvars.AllCompletionSound[globalvars.MapsFinished] = false;
				globalvars.AllCompletionTimer.push(globalvars.MapsFinished);
				globalvars.AllCompletionTimer[globalvars.MapsFinished];
				if (dydudebug_mapfinishcheck) Console.Printf("\c[blue]Not Reopen\c- [maps in queue: %d]", globalvars.MapsFinished);
			}
			else
			{
				if (dydudebug_mapfinishcheck) Console.Printf("\c[brick]Map Has Been Visited before (non-hub)\c- [levelnum: %d, maps visited: %d]", level.levelnum, globalvars.MapsFinished);
			}
		}
		else
		{
			if (!e.IsSaveGame) if (dydudebug_mapfinishcheck) Console.Printf("\c[brick]Map Has Been Visited before (hub)\c- [levelnum: %d, maps visited: %d]", level.levelnum, globalvars.MapsFinished);
		}

		// Post LevelPostProcess Compatibility Stuff >_>
		string giveitem = "PlayingRAMP";
		if (level.GetChecksum() == '8e1d1b012a817bb8828d7096dd1ecc28' && !player.FindInventory(giveitem)) // ramp.pk3 map01
		{
			player.A_SetInventory(giveitem,1);
			Console.Printf("LOLE Welcome to R.A.M.P., Kiddo! :V");
		}
		giveitem = "PlayingGoingDown";
		if (level.GetChecksum() == '1dfcba1353e9bbf720f17639f294490d' && !player.FindInventory(giveitem)) // gd.wad [Going Down] map01
		{
			player.A_SetInventory(giveitem,1);
			Console.Printf("LOLE Welcome to Going Down, Kiddo! :V");
		}
		giveitem = "PlayingPSXDoom";
		if (level.GetChecksum() == '1dfcba1353e9bbf720f17639f294490d' && !player.FindInventory(giveitem)) // gd.wad [Going Down] map01
		{
			player.A_SetInventory(giveitem,1);
			Console.Printf("LOLE Welcome to PSX Doom TC, Kiddo! V:<");
		}
		giveitem = "PlayingAugerZenith";
		if (level.GetChecksum() == 'a130224617d892e5023ab43392f4000d' && !player.FindInventory(giveitem)) // DBP37_AUGZEN.wad [AUGER ZENITH] map01
		{
			player.A_SetInventory(giveitem,1);
			Console.Printf("LOLE Welcome to AUGER ZENITH, Kiddo! V:<");
		}
		
		if (!Player.CountInv("EWShieldDefendMode") && Player.bREFLECTIVE) Player.bREFLECTIVE = false;
		if (!Player.CountInv("EWShieldDefendMode") && Player.bSHIELDREFLECT) Player.bSHIELDREFLECT = false;
		
		if (BatGuardCheck)
		{
			actor Player = players[0].mo;
			let IsPlayer = PlayerPawn(Player);
			if (IsPlayer)
			{
				let weapon = IsPlayer.Player.ReadyWeapon;
				// Resets the Cricket Bat guardstate and cooldown to neutral, so the first time
				// you attempt to guard after a level transition doesn't immediately UNGUARD after
				// the initial animation. V:
				if (weapon is "CricketBat")
				{
					let DDWeap = CricketBat(weapon);
					if (DDWeap)
					{
						if (DDWeap.guardstate) DDWeap.guardstate = 0;
						if (DDWeap.guardcooldown) DDWeap.guardcooldown = 0;
						if (dydudebug_worldloaded) Console.Printf("BatGuard Check - GuardState: %d, Cooldown: %d", DDWeap.guardstate, DDWeap.guardcooldown);
					}
				}
			}
		}

		Super.WorldLoaded(e);
	}
	
	override void PlayerDied(PlayerEvent e) 
	{
		if (exex_deathmusic)
		{
			if (exex_deathmusic == 1) S_ChangeMusic("GAMOVR", 0, false, true);
			if (exex_deathmusic == 2) S_ChangeMusic("RoReDead", 0, false, true);
			if (exex_deathmusic == 3) S_ChangeMusic("GaOvYe", 0, false, true);
			if (exex_deathmusic == 4) S_ChangeMusic("DRQUDEAD", 0, false, true);
			if (exex_deathmusic == 5) S_ChangeMusic("MiRiBuTi", 0, false, true);
			if (exex_deathmusic == 6) S_ChangeMusic("ToDiYoAD", 0, false, true);
			if (exex_deathmusic == 7) S_ChangeMusic("MGS2GMOV", 0, false, true);
			if (exex_deathmusic == 8) S_ChangeMusic("ShGYaheh", 0, false, true);
			if (exex_deathmusic == 9) S_ChangeMusic("AH3GMOVR", 0, false, true);
			if (exex_deathmusic == 10) S_ChangeMusic("JURPRKP2", 0, false, true);
			if (exex_deathmusic == 11) S_ChangeMusic("CUYOENTH", 0, false, true);
		}
		Super.PlayerDied(e);
	}
	
	override void PlayerRespawned(PlayerEvent e) 
	{
		S_ChangeMusic("*", 0, true, true);
		Super.PlayerRespawned(e);
	}
	
	override bool InputProcess (InputEvent e)
	{
		if (e.Type == InputEvent.Type_KeyDown)
			SendNetworkEvent("AAAX", e.KeyScan);
		
		return false;
	}
	
	override void NetworkProcess(ConsoleEvent e)
	{
		Actor player = players[consoleplayer].mo;
		int buttons = player.GetPlayerInput(INPUT_BUTTONS);
		if (e.Name == "AAAX")   
		{
			int key1, key2;

			[key1, key2] = Bindings.GetKeysForCommand("MKeyTest");
			if ((key1 && key1 == e.Args[0]) || (key2 && key2 == e.Args[0]))
			{
				if (buttons & BT_SPEED) level.total_monsters += 1;
													 else level.total_monsters -= 1;
			}
			[key1, key2] = Bindings.GetKeysForCommand("MKeyTest2");
			if ((key1 && key1 == e.Args[0]) || (key2 && key2 == e.Args[0]))
			{
				if (buttons & BT_SPEED) level.total_items += 1;
													 else level.total_items -= 1;
			}
			[key1, key2] = Bindings.GetKeysForCommand("MKeyTest3");
			if ((key1 && key1 == e.Args[0]) || (key2 && key2 == e.Args[0]))
			{
				if (buttons & BT_SPEED) level.total_secrets += 1;
													 else level.total_secrets -= 1;
			}

			[key1, key2] = Bindings.GetKeysForCommand("UseArmorIP");
			if ((key1 && key1 == e.Args[0]) || (key2 && key2 == e.Args[0]))
			{
				if (player.CountInv("KnightGownItem"))
				{
					player.A_SetInventory("KnightGown1IPItem",1);
				}
				else
				if (player.CountInv("KnightGownItem2"))
				{
					player.A_SetInventory("KnightGown2IPItem",1);
				}
				else
				if (player.CountInv("KnightGownItem3"))
				{
					player.A_SetInventory("KnightGown3IPItem",1);
				}
				else
				if (player.CountInv("KnightGownItem4"))
				{
					player.A_SetInventory("KnightGown4IPItem",1);
				}
			}
			[key1, key2] = Bindings.GetKeysForCommand("Whistl");
			if ((key1 && key1 == e.Args[0]) || (key2 && key2 == e.Args[0]))
			{
				let MiscItem = PlayerStatItem(player.FindInventory("PlayerStatItem"));
				if (MiscItem)
				{
					if (MiscItem.whistlecooldown == 0)
					{
						player.A_SpawnItemEx("PlayerWhistle",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION);
						if (player.CountInv("PowerStrength") || player.CountInv("PowerStrengthDD")) MiscItem.whistlecooldown = random(28,33);
																																									 else MiscItem.whistlecooldown = random(42,49);
					}
				}
			}
			[key1, key2] = Bindings.GetKeysForCommand("RecallAll");
			if ((key1 && key1 == e.Args[0]) || (key2 && key2 == e.Args[0]))
			{
				let MiscItem = DDPlayerPawn(player);
				if (DDPlayerPawn(player))
				{
					if (!automapactive) MiscItem.recalledall = true;
				}
			}
		}
	}
	
	override void UiTick()
	{
		int ChangedMusicDefault;
		if (Level.MapName == "TITLEMAP" && level.GetCheckSum() == "abd744f154f8268263504fe9260f9445")
		{
			int d;
			d = Wads.CheckNumForName("EE-UNFAM", Wads.ns_global, -1, true);
			if (d == -1) d = Wads.CheckNumForName("smooshed", Wads.ns_global, -1, true);
			//Console.Printf("d: %d", d);
			if (d == -1)
			{
				//Console.Printf("UiTick");
				if (exex_titlemusic >= 1)
				{
					if (exex_titlemusic == 1)
					{
						S_ChangeMusic("EE-TITLE",0,true,true); // The unused theme played in the original Dynamite Duchess trailer on Youtube is the mod's "main" theme
						SetMusicVolume(4.5);
					}
					if (exex_titlemusic == 2)
					{
						S_ChangeMusic("BGMTHEME",0,true,true); // The titlemusic for Dynamite Duchess
						SetMusicVolume(2.25);
					}
					if (exex_titlemusic == 3)
					{
						S_ChangeMusic("BGMTHEMA",0,true,true); // The titlemusic for Appetite for Detention
						SetMusicVolume(2.25);
					}
					if (exex_titlemusic == 4)
					{
						S_ChangeMusic("COS-TITL",0,true,true); // The titlemusic for ??????? ?? ?????
						SetMusicVolume(2.25);
					}
				}
				else
				if (exex_titlemusic == 0) // Use the default title music for the gamemode/mapset if viable
				{
					SetMusicVolume(1.25);
					if (gameinfo.GameType == GAME_Doom)
					{
						if (Wads.CheckNumForName("MAP01", Wads.ns_global, -1, false)) S_ChangeMusic("$MUSIC_DM2TTL", 0, true, true);
						if (Wads.CheckNumForName("E1M1", Wads.ns_global, -1, false)) S_ChangeMusic("$MUSIC_INTRO", 0, true, true);
					}
					if (gameinfo.GameType == GAME_Heretic) S_ChangeMusic("MUS_TITL", 0, true, true);
					if (gameinfo.GameType == GAME_Hexen) S_ChangeMusic("HEXEN", 0, true, true);
					if (gameinfo.GameType == GAME_Strife) S_ChangeMusic("D_LOGO", 0, true, true);
					ChangedMusicDefault = 0;
				}
				else
				if (exex_titlemusic <= -1)
				{
					if (!ChangedMusicDefault)
					{
						S_ChangeMusic("*", 0, true, true);
						ChangedMusicDefault = 0;
					}
				}
			}
		}
		super.UiTick();
	}

	override void RenderOverlay(RenderEvent e)
	{
		// 55c72622920cbabcb1a2ec26e03bc3d0 = KDIZD TITLEMAP
		if (Level.MapName == "TITLEMAP" && level.GetCheckSum() == "abd744f154f8268263504fe9260f9445")
		{
			//Console.Printf("RenderOverlay: level.time - %d", level.time);
			textureid titleimg;
			string titlenm;
			int visi;
			int timer = level.time % 716;
			if (exex_titlescreen >= 0)
			{
				textureid titlepic = TexMan.checkForTexture("DEFTITLE");
				if (titlepic) Screen.DrawTexture(titlepic, false, 0, 0, DTA_FullScreen, true);
				if (exex_titlescreen >= 1)
				{
					// Background
					textureid titlepic = TexMan.checkForTexture("EXEXTILB");
					if (titlepic) Screen.DrawTexture(titlepic, false, 0, 0, DTA_FullScreen, true);
					// Title Image
					titleimg = TexMan.checkForTexture("EXEXT3XS");
					if (titleimg) Screen.DrawTexture(titleimg, false, 360, 360, DTA_KeepRatio, true);
					// Dinah
					titleimg = TexMan.checkForTexture("EXEXDINH");
					if (titleimg) Screen.DrawTexture(titleimg, false, 800, 180, DTA_KeepRatio, true);
					// ???
					visi = 0;
					if (timer >= 351)
					{
						if (timer >= 351 && timer <= 358) visi = 5;
						if (timer >= 359 && timer <= 366) visi = 10;
						if (timer >= 367 && timer <= 374) visi = 15;
						if (timer >= 375 && timer <= 382) visi = 20;
						if (timer >= 383 && timer <= 390) visi = 25;
						if (timer >= 391 && timer <= 398) visi = 30;
						if (timer >= 399 && timer <= 406) visi = 35;
						if (timer >= 407 && timer <= 414) visi = 40;
						if (timer >= 415 && timer <= 422) visi = 45;
						if (timer >= 423 && timer <= 430) visi = 50;
						if (timer >= 431 && timer <= 438) visi = 55;
						if (timer >= 439 && timer <= 446) visi = 60;
						if (timer >= 447 && timer <= 454) visi = 65;
						if (timer >= 455 && timer <= 462) visi = 70;
						if (timer >= 463 && timer <= 470) visi = 75;
						if (timer >= 471 && timer <= 478) visi = 80;
						if (timer >= 479 && timer <= 486) visi = 85;
						if (timer >= 487 && timer <= 494) visi = 90;
						if (timer >= 495 && timer <= 502) visi = 95;
						if (timer >= 503 && timer <= 677) visi = 100;
						if (timer >= 678 && timer <= 679) visi = 95;
						if (timer >= 680 && timer <= 681) visi = 90;
						if (timer >= 682 && timer <= 683) visi = 85;
						if (timer >= 684 && timer <= 685) visi = 80;
						if (timer >= 686 && timer <= 687) visi = 75;
						if (timer >= 688 && timer <= 689) visi = 70;
						if (timer >= 690 && timer <= 691) visi = 65;
						if (timer >= 692 && timer <= 693) visi = 60;
						if (timer >= 694 && timer <= 695) visi = 55;
						if (timer >= 696 && timer <= 697) visi = 50;
						if (timer >= 698 && timer <= 699) visi = 45;
						if (timer >= 700 && timer <= 701) visi = 40;
						if (timer >= 702 && timer <= 703) visi = 35;
						if (timer >= 704 && timer <= 705) visi = 30;
						if (timer >= 706 && timer <= 707) visi = 25;
						if (timer >= 708 && timer <= 709) visi = 20;
						if (timer >= 710 && timer <= 711) visi = 15;
						if (timer >= 712 && timer <= 713) visi = 10;
						if (timer >= 714 && timer <= 715) visi = 5;
					}
					titlenm = "EXTID";
					if (visi >= 100) titlenm.AppendFormat("%d", visi);
					if (visi < 100) titlenm.AppendFormat("0%d", visi);
					if (visi < 10) titlenm.AppendFormat("00%d", visi);
					titleimg = TexMan.checkForTexture(titlenm);
					if (titleimg) Screen.DrawTexture(titleimg, false, 1258, 481, DTA_KeepRatio, true);
				}
				else
				if (exex_titlescreen == 0)
				{
					if (gameinfo.GameType == GAME_Doom) titlepic = TexMan.checkForTexture("TITLEPIC");
					if (gameinfo.GameType == GAME_Heretic) titlepic = TexMan.checkForTexture("TITLE");
					if (gameinfo.GameType == GAME_Hexen) titlepic = TexMan.checkForTexture("TITLE");
					if (gameinfo.GameType == GAME_Strife) titlepic = TexMan.checkForTexture("TITLEPIC");
					if (titlepic) Screen.DrawTexture(titlepic, false, 0, 0, DTA_FullScreen, true);
				}
			}
		}
		super.RenderOverlay(e);
	}
}

class ItemData
{
	Inventory savedItem;
	bool wasUndroppable;
	bool wasUntossable;
	int hadAmount;
}

class DD_StaticEventHandler : StaticEventHandler
{
	// So I don't forget, a lot of the code in this for keeping things on Resets is from DevilBlackDeath's "Inventory Keeper" minimod. A lot of the comments below are his on the effects. :V
	struct PlayerInvData
	{
		Inventory invFirst;
		Inventory invSel;
		Inventory ReadyWeapon;
	}

	private bool isNewGame; // This is a new game, nothing should be done in this situation !
	private PlayerInvData[MAXPLAYERS] savedInventory; // Inventory backup for players
	// Items set to undroppable and untossable, once the world is loaded they should go back to their original state
	private Array<ItemData> dropBlockers;
	private int[MAXPLAYERS] playerNeedsRestore; // List of players to restore (players in game)
	private Array<int> playersToResurrect; // List of players to resurrect from a death exit
	private int prevhealthval; // added by Misfit V:

	private void ResurrectPlayers()
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- ResurrectPlayers() activated");
		for (int i = 0; i < playersToResurrect.Size(); i++)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ResurrectPlayers [2], i: %d", i);
			PlayerInfo pi = players[playersToResurrect[i]];
			PlayerPawn p = PlayerPawn(pi.mo);

			/* Resurrect the player, this is the only way to keep their inventory intact
			   during intermission - DBD*/
			if (playeringame[playersToResurrect[i]] && p != null)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ResurrectPlayers [3], i: %d", i);
				pi.Resurrect();
			}
		}
	}

	private void ManageKeys()
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- ManageKeys() activated");
		bool keepKeys = false; // Defaulting to false if no value is found 
						
		if (CVar.FindCVar("exex_deathexitkeepkeys") != null)
			keepKeys = CVar.FindCVar("exex_deathexitkeepkeys").GetBool();
		
		if (!keepKeys)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageKeys [2 - KeepKeys is off]");
			for (int i = 0; i < MAXPLAYERS; i++)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageKeys [3 - Player#]:\c- %d", i);
				PlayerInfo pi = players[i];
				PlayerPawn p = PlayerPawn(pi.mo);

				if (playeringame[i] && p != null && playersToResurrect.Find(i) < playersToResurrect.Size())
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageKeys [4 - playersToResurrect]");
					Inventory item = p.Inv;

					while (item != null) 
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageKeys [5 - Item Check]:\c- %s", item.GetClassName());
						// Not checking for level-specific stuff like keys as this
						// seems to be automatically invalidated
						if (item is 'Key') 
						{
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageKeys [6a - Key Type Found]:\c- %s", item.GetClassName());
							p.RemoveInventory(item);
							item = p.Inv;
						}
						else
							item = item.Inv;
					}
				}
			}
		}
	}

	/* ManageHealth is my own personal addition to the ResetInventory check stuff for the mod, 
	for future purposes, so no code yet - Misfit :V */
	private void ManageHealth()
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- ManageHealth() activated");
		bool keepHealth = true; // Defaulting to false if no value is found 
						
		if (CVar.FindCVar("exex_deathexitkeephealth") != null)
			keepHealth = CVar.FindCVar("exex_deathexitkeephealth").GetBool();
		
		for (int i = 0; i < MAXPLAYERS; i++)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageHealth [2 - Player#], i: %d", i);
			PlayerInfo pi = players[i];
			PlayerPawn p = PlayerPawn(pi.mo);
			
			if (playeringame[i] && p != null)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageHealth [3 - playeringame]:\c- i: %d", i);
				if (keepHealth)
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageHealth [4a - keepHealth is \c[gold]ON\c[green]]");
					if (p.health > 0)
					{
						prevhealthval = p.health;
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageHealth [5a - playeringame], i: %d, prevhealthval: %d", i, prevhealthval);
					}
					else
					{
						prevhealthval = 1;
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageHealth [5b - playeringame], i: %d, prevhealthval: %d", i, prevhealthval);
					}
				}
				else
				{
					prevhealthval = p.health;
					if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageHealth [4b - keepHealth is \c[red]OFF\c[green]\c]");
				}
			}
		}
	}

	private void ManageWeapons()
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- ManageWeapons() activated");
		bool keepWeapons = true; // Defaulting to true if no value is found 
		bool keepBackpacks = true; // Defaulting to true if no value is found 
		bool keepWeaponupgrades = true; // Defaulting to true if no value is found 
		bool keepSigil = true; // Defaulting to true if no value is found 

		if (CVar.FindCVar("exex_deathexitkeepweapons") != null)
			keepWeapons = CVar.FindCVar("exex_deathexitkeepweapons").GetBool();

		if (CVar.FindCVar("exex_deathexitkeepbackpacks") != null)
			keepBackpacks = CVar.FindCVar("exex_deathexitkeepbackpacks").GetBool();

		if (CVar.FindCVar("exex_deathexitkeepweaponupgrades") != null)
			keepWeaponupgrades = CVar.FindCVar("exex_deathexitkeepweaponupgrades").GetBool();

		if (CVar.FindCVar("exex_deathexitkeepsigil") != null)
			keepSigil = CVar.FindCVar("exex_deathexitkeepsigil").GetBool();

		if (!keepWeapons)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageWeapons [2 - KeepWeapons is off]");
			for (int i = 0; i < MAXPLAYERS; i++)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [3 - Player#], i: %d", i);
				PlayerInfo pi = players[i];
				PlayerPawn p = PlayerPawn(pi.mo);

				if (playeringame[i] && p != null && playersToResurrect.Find(i) < playersToResurrect.Size())
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [4 - playersToResurrect], i: %d", i);
					Inventory item = p.Inv;

					while (item != null) 
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [5 - Item Check]:\c- i: %d, %s", i, item.GetClassName());
						// Not checking for level-specific stuff like keys as this
						// seems to be automatically invalidated
						if (item is 'Weapon' ||
								item is 'BasicArmor' ||
								item is 'KGArmor' ||
								item is 'HexenArmor' ||
								item is 'Ammo' ||
								item is 'VacAmmoCounter')
						{
							if (keepSigil && 
									(Item is 'SigilDD' ||
									 Item is 'SigilPieces' ||
									 Item is 'SigilModeType'))
							{
								if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [6ba - Sigil Found and Kept]: i: %d, %s", i, item.GetClassName());
								item = item.Inv;
							}
							else
							{
								if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [6a - 'Weapon' Type Found]: i: %d, %s", i, item.GetClassName());
								p.RemoveInventory(item);
								item = p.Inv;
							}
						}
						else
						{
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [6bb - Weapon Found and Kept]: i: %d, %s", i, item.GetClassName());
							item = item.Inv;
						}
					}
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [7 - GiveDefaultInventory]: i: %d", i);
					p.GiveDefaultInventory(); // Give the default inventory 
				}
			}
		}
		
		if (!keepBackpacks)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageWeapons [2 - keepBackpacks is off]");
			for (int i = 0; i < MAXPLAYERS; i++)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [3 - Player#], i: %d", i);
				PlayerInfo pi = players[i];
				PlayerPawn p = PlayerPawn(pi.mo);

				if (playeringame[i] && p != null && playersToResurrect.Find(i) < playersToResurrect.Size())
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [4 - playersToResurrect], i: %d", i);
					Inventory item = p.Inv;

					while (item != null) 
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [5 - Item Check]:\c- i: %d, %s", i, item.GetClassName());
						// Not checking for level-specific stuff like keys as this
						// seems to be automatically invalidated
						if (item is 'Backpack' ||
								item is 'BackpackTier1' ||
								item is 'BackpackTier2')
						{
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [6a - 'Backpack' Type Found]: i: %d, %s", i, item.GetClassName());
							p.RemoveInventory(item);
							item = p.Inv;
						}
						else
						{
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [6bb - Weapon Found and Kept]: i: %d, %s", i, item.GetClassName());
							item = item.Inv;
						}
					}
				}
			}
		}

		if (!KeepWeaponUpgrades)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageWeapons [8 - KeepWeaponsUpgrades is off]");
			for (int i = 0; i < MAXPLAYERS; i++)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [9 - Player#], i: %d", i);
				PlayerInfo pi = players[i];
				PlayerPawn p = PlayerPawn(pi.mo);

				if (playeringame[i] && p != null && playersToResurrect.Find(i) < playersToResurrect.Size())
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [10 - playersToResurrect], i: %d", i);
					Inventory item = p.Inv;

					while (item != null) 
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [11 - Item Check]:\c- i: %d, %s", i, item.GetClassName());
						// Not checking for level-specific stuff like keys as this
						// seems to be automatically invalidated
						if (item is 'BlunderShotUpgrade' || 
								item is 'GrimophoneUpgrade' || 
								item is 'ArmorScavengerKit' || 
								item is 'HellWarriorShieldLevel')
						{
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [12a - 'Weapon' Type Found]: i: %d, %s", i, item.GetClassName());
							p.RemoveInventory(item);
							item = p.Inv;
						}
						else
							item = item.Inv;
					}
					//if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [13 - GiveDefaultInventory]: i: %d", i);
					//p.GiveDefaultInventory(); // Give the default inventory 
				}
			}
		}

		if (!keepSigil)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ManageWeapons [13 - KeepSigil is off]");
			for (int i = 0; i < MAXPLAYERS; i++)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [14 - Player#], i: %d", i);
				PlayerInfo pi = players[i];
				PlayerPawn p = PlayerPawn(pi.mo);

				if (playeringame[i] && p != null && playersToResurrect.Find(i) < playersToResurrect.Size())
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [15 - playersToResurrect], i: %d", i);
					Inventory item = p.Inv;

					while (item != null) 
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [16 - Item Check]:\c- i: %d, %s", i, item.GetClassName());
						// Not checking for level-specific stuff like keys as this
						// seems to be automatically invalidated
						if (item is 'SigilDD' ||
								item is 'SigilPieces' ||
								item is 'SigilModeType')
						{
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]ManageWeapons [17a - 'Weapon' Type Found]: i: %d, %s", i, item.GetClassName());
							p.RemoveInventory(item);
							item = p.Inv;
						}
						else
							item = item.Inv;
					}
				}
			}
		}
	}

	private void RestorePlayerInvState(int pNum)
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- RestorePlayerInvState() activated");
		PlayerInfo pi = players[pNum];
		PlayerPawn p = PlayerPawn(pi.mo);

		if (playeringame[pNum] && p != null && playerNeedsRestore[pNum])
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]RestorePlayerInvState [2 - playeringame]:\c- pnum: %d", pnum);
			bool keepWeapons = true; // Defaulting to true if no value is found 

			if (CVar.FindCVar("exex_deathexitkeepweapons") != null)
				keepWeapons = CVar.FindCVar("exex_deathexitkeepweapons").GetBool();

			if (p.CountInv("ResetInventory") || p.CountInv("PlayerIsDead"))
			{
				if (prevhealthval > 0)
				{
					p.health = prevhealthval;
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestorePlayerInvState [3a - resetting health to previous]:\c- pNum: %d, %d", pNum, p.health);
				}
				else
				{
					let MiscItem = PlayerStatItem(p.FindInventory("PlayerStatItem"));
					if (MiscItem) p.health = MiscItem.MaxHealthTrue;
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestorePlayerInvState [3b - resetting health to current max:\c- pNum: %d, %d", pNum, p.health);
				}
			}

			/* We restore the player's inventory state
			   This is not to give the player back their inventory, they technically
			   still have it after the resurrection, this is mostly to make sure
			   the selected inventory item and equipped weapons remain the same
			   (from tests, these seem to reset on death+resurrect) */
			p.InvFirst = savedInventory[pNum].invFirst;
			p.InvSel = savedInventory[pNum].invSel;
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]RestorePlayerInvState [4 - savedinventory]:\c- pNum: %d", pNum);

			/* We restore the readied weapon only if weapons are kept, otherwise,
			   the game changing the readied weapons is the effect of losing them on purpose ! */
			if (keepWeapons)
			{
				pi.PendingWeapon = Weapon(savedInventory[pNum].readyWeapon);
				if (dydudebug_resetinventorydebug) Console.Printf("\c[green]RestorePlayerInvState [5 - keepWeapons on]:\c- pNum: %d", pNum);
			}
		}
	}

	void BackupInventories()
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- BackupInventories() activated");
		for (int i = 0; i < MAXPLAYERS; i++)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]BackupInventories [2 - player#]:\c- i: %d", i);
			PlayerInfo pi = players[i];
			PlayerPawn p = PlayerPawn(pi.mo);

			if (playeringame[i] && p != null)
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]BackupInventories [3 - playeringame]: i: %d", i);
				// This player needs to be restored
				playerNeedsRestore[i] = true;

				/* Save all important inventory informations (what item was
				   selected, and what weapon was equipped, these may get unequipped on death) */
				savedInventory[i].invFirst = p.InvFirst;
				savedInventory[i].invSel = p.InvSel;
				savedInventory[i].readyWeapon = pi.ReadyWeapon;
			}
		}
	}

	private void RestoreItemsState() 
	{
		bool keepWeapons = true; // Defaulting to true if no value is found
		bool keepBackpacks = true; // Defaulting to true if no value is found
		bool keepWeaponUpgrades = true; // Defaulting to true if no value is found
		bool keepSigil = true; // Defaulting to true if no value is found 
		bool keepInvBarItems = true; // Defaulting to true if no value is found
		bool keepKeys = false; // Defaulting to false if no value is found

		if (CVar.FindCVar("exex_deathexitkeepweapons") != null)
			keepWeapons = CVar.FindCVar("exex_deathexitkeepweapons").GetBool();
		
		if (CVar.FindCVar("exex_deathexitkeepbackpacks") != null)
			keepBackpacks = CVar.FindCVar("exex_deathexitkeepbackpacks").GetBool();
		
		if (CVar.FindCVar("exex_deathexitkeepweaponupgrades") != null)
			keepWeaponUpgrades = CVar.FindCVar("exex_deathexitkeepweaponupgrades").GetBool();

		if (CVar.FindCVar("exex_deathexitkeepsigil") != null)
			keepSigil = CVar.FindCVar("exex_deathexitkeepsigil").GetBool();
			
		if (CVar.FindCVar("exex_deathexitkeepinventoryitems") != null)
			keepInvBarItems = CVar.FindCVar("exex_deathexitkeepinventoryitems").GetBool();
			
		if (CVar.FindCVar("exex_deathexitkeepkeys") != null)
			keepKeys = CVar.FindCVar("exex_deathexitkeepkeys").GetBool();

		ResetInventory ResetItem;
		PlayerIsDead DeadItem;
		int ResetItemAmt;
		int DeadItemAmt;
		for (int i = 0; i < dropBlockers.Size(); i++)
		{
			ResetItem = ResetInventory(dropBlockers[i].savedItem);
			DeadItem = PlayerIsDead(dropBlockers[i].savedItem);
			if (ResetItem) ResetItemAmt = ResetItem.Amount;
			if (DeadItem) DeadItemAmt = DeadItem.Amount;
			if ((ResetItem && ResetItemAmt) || (DeadItem && DeadItemAmt)) break;
		}
		if (dydudebug_resetinventorydebug) 
		{
					if (ResetItem && ResetItemAmt) Console.Printf("\c[green]ResetInventory:\c- Found ResetInventory Item!");
			else if (DeadItem && DeadItemAmt) Console.Printf("\c[green]ResetInventory:\c- Found PlayerIsDead Item!");
										else Console.Printf("\c[green]ResetInventory:\c- Did NOT find ResetInventory or PlayerIsDead Items!");
		}

		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- RestoreItemsState() activated");
		for (int i = 0; i < dropBlockers.Size(); i++)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [2 - dropblockers]:\c- i: %d / %d", i, dropBlockers.Size());
			Inventory item = dropBlockers[i].savedItem;
			if (item != null) 
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [3 - item check]:\c- i: %d, %s", i, item.GetClassName());
				item.bUndroppable = dropBlockers[i].wasUndroppable;
				item.bUntossable = dropBlockers[i].wasUntossable;

				/* We don't restore weapons, armors and ammos amount, otherwise on an
				   inventory reset, the player won't be actually in a pistol start state */
				bool keepinv = true;
				if (!keepWeapons &&
						(item is 'Weapon' || 
						 item is 'BasicArmor' || 
						 item is 'KGArmor' || 
						 item is 'HexenArmor' || 
						 item is 'Ammo' || 
						 item is 'VacAmmoCounter'))
				{
					if (keepSigil &&
							(item is 'SigilDD' || item is 'SigilPieces' || item is 'SigilModeType'))
					{
						keepinv = true;
					}
					else
					{
						keepinv = false;
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [4a - Weapon Check [!keepWeapons]: \c[red]not saved\c[blue]]:\c- i: %d, %s", i, item.GetClassName());
					}
				}
				if (!keepBackpacks &&
						(item is 'Backpack' ||
						 item is 'BackpackTier1' ||
						 item is 'BackpackTier2'))
				{
					keepinv = false;
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [4a - Weapon Check [!keepBackpacks]: \c[red]not saved\c[blue]]:\c- i: %d, %s", i, item.GetClassName());
				}
				if (!keepWeaponUpgrades &&
						(item is 'BlunderShotUpgrade' || 
						item is 'GrimophoneUpgrade' || 
						item is 'ArmorScavengerKit' || 
						item is 'HellWarriorShieldLevel'))
				{
					keepinv = false;
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [4a - Weapon Upgrade Check  [!keepWeaponUpgrades]: \c[red]not saved\c[blue]]:\c- i: %d, %s", i, item.GetClassName());
				}
				if (!keepSigil &&
					  (item is 'SigilDD' || item is 'SigilPieces' || item is 'SigilModeType'))
				{
					keepinv = false;
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [4a - Sigil Check  [!keepSigil]: \c[red]not saved\c[blue]]:\c- i: %d, %s", i, item.GetClassName());
				}
				if (!keepInvBarItems && 
						(item is 'ExExInvBarItem' || item is 'KilletanteEffigy'))
				{
					if ((ResetItem && ResetItemAmt) || (DeadItem && DeadItemAmt))
					{
						item.Amount = 0;
						keepinv = false;
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [4ca - EEInvItem Check: \c[red]not saved (death/reset)\c[blue]]:\c- i: %d, %s", i, item.GetClassName());
					}
					else
					{
						keepinv = true;
					}
				}
				//
				//
				if (keepinv)
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]RestoreItemsState [5 - \c[gold]Item Saved\c[blue]]:\c- i: %d, %s (hadamount: %d)", i, item.GetClassName(), dropBlockers[i].hadAmount);
					item.Amount = dropBlockers[i].hadAmount;
				}
			}
		}

		dropBlockers.Clear();
	}

	private void MakeInventoryUndroppable() 
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- MakeInventoryUndroppable() activated");
		for (int i = 0; i < MAXPLAYERS; i++) 
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [2 - player#]: i: %d", i);
			if (playeringame[i] && players[i].mo != null) 
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [3 - playeringame]: i: %d", i);
				for (Inventory item = players[i].mo.Inv; item != null; item = item.Inv) 
				{
					if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [4 - item check]: i: %d, %s", i, item.GetClassName());
					bool keepWeapons = true; // Defaulting to true if no value is found
					bool keepBackpacks = true; // Defaulting to true if no value is found
					bool keepWeaponupgrades = true; // Defaulting to true if no value is found 
					bool keepSigil = true; // Defaulting to true if no value is found 
					bool keepInvBarItems = true; // Defaulting to true if no value is found
					bool keepKeys = false; // Defaulting to false if no value is found

					if (CVar.FindCVar("exex_deathexitkeepweapons") != null)
						keepWeapons = CVar.FindCVar("exex_deathexitkeepweapons").GetBool();
					
					if (CVar.FindCVar("exex_deathexitkeepbackpacks") != null)
						keepBackpacks = CVar.FindCVar("exex_deathexitkeepbackpacks").GetBool();
					
					if (CVar.FindCVar("exex_deathexitkeepweaponupgrades") != null)
						keepWeaponUpgrades = CVar.FindCVar("exex_deathexitkeepweaponupgrades").GetBool();
					
					if (CVar.FindCVar("exex_deathexitkeepsigil") != null)
						keepSigil = CVar.FindCVar("exex_deathexitkeepsigil").GetBool();
					
					if (CVar.FindCVar("exex_deathexitkeepinventoryitems") != null)
						keepInvBarItems = CVar.FindCVar("exex_deathexitkeepinventoryitems").GetBool();
						
					if (CVar.FindCVar("exex_deathexitkeepkeys") != null)
						keepKeys = CVar.FindCVar("exex_deathexitkeepkeys").GetBool();
					
					// Save the item's actual UNDROPPABLE and UNTOSSABLE tags
					ItemData id = new('ItemData');
					id.savedItem = item;
					id.wasUndroppable = item.bUndroppable;
					id.wasUntossable = item.bUntossable;
					id.hadAmount = item.Amount;
					dropBlockers.Push(id);

					if (!keepWeapons && 
							(item is 'Weapon' ||
							 item is 'BasicArmor' ||
							 item is 'KGArmor' ||
							 item is 'HexenArmor' ||
							 item is 'Ammo' ||
							 item is 'VacAmmoCounter'))
					{
						// Make the weapon/armor/ammo droppable so it will be removed during a map-initiated
						// inventory reset, we'll restore their actual values at the beginning of the next level
						// This is done so you actually do a Pistol Start when intended if you decided to not keep weapons !
						if (keepSigil &&
								(item is 'SigilDD' || 
								item is 'SigilPieces' || 
								item is 'SigilModeType'))
						{
							// Make the items undroppable so it won't be removed during a map-initiated
							// inventory reset, we'll restore their actual values at the beginning of the next level
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5g - make item undroppable/untossable (Sigil Found)]: \c-%s", item.GetClassName());
							item.bUndroppable = true;
							item.bUntossable = true;
						}
						else
						{
							if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5a - KeepWeapons off]: \c-%s", item.GetClassName());
							item.bUndroppable = false;
							item.bUntossable = false;
						}
					}
					else
					if (!keepBackPacks &&
							(item is 'Backpack' ||
							 item is 'BackpackTier1' ||
							 item is 'BackpackTier2'))
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5b - keepBackPacks off]: \c-%s", item.GetClassName());
						item.bUndroppable = false;
						item.bUntossable = false;
					}
					else
					if (!keepWeaponUpgrades &&
							(item is 'BlunderShotUpgrade' || 
							 item is 'GrimophoneUpgrade' || 
							 item is 'ArmorScavengerKit' || 
							 item is 'HellWarriorShieldLevel'))
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5c - keepWeaponUpgrades off]: \c-%s", item.GetClassName());
						item.bUndroppable = false;
						item.bUntossable = false;
					}
					else
					if (!keepSigil &&
							(item is 'SigilDD' || 
							 item is 'SigilPieces' || 
							 item is 'SigilModeType'))
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5d - KeepSigil off]: \c-%s", item.GetClassName());
						item.bUndroppable = false;
						item.bUntossable = false;
					}
					else 
					if (!keepInvBarItems && 
							(item is 'ExExInvBarItem' || 
							 item is 'KilletanteEffigy'))
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5e - KeepInvBarItems off]: \c-%s", item.GetClassName());
						item.bUndroppable = false;
						item.bUntossable = false;
					}
					else 
					if (!KeepKeys &&
							(item is 'Key'))
					{
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5f - KeepKeys off]: \c-%s", item.GetClassName());
						item.bUndroppable = false;
						item.bUntossable = false;
					}
					else
					{
						// Make the items undroppable so it won't be removed during a map-initiated
						// inventory reset, we'll restore their actual values at the beginning of the next level
						if (dydudebug_resetinventorydebug) Console.Printf("\c[blue]MakeInventoryUndroppable [5g - make item undroppable/untossable]: \c-%s", item.GetClassName());
						item.bUndroppable = true;
						item.bUntossable = true;
					}
				}
			}
		}
	}
    
	private void ResetResurrectionQueue(int i) 
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- ResetResurrectionQueue(%d) activated", i);
		if (playeringame[i] && players[i].mo != null)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetResurrectionQueue (clear resurrect queue) [2 - playeringame]\c-: %d", i);
			int delIndex = playersToResurrect.Find(i);

			if (delIndex < playersToResurrect.Size())
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetResurrectionQueue (clear resurrect queue) [3 - delIndex (\c-i: %d\c[green])\c-: %d", i, delindex);
				playersToResurrect.Delete(delIndex);
				playersToResurrect.ShrinkToFit();
			}
		}
	}

	// Event functions override
	override void OnRegister()
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- OnRegister() activated");
		isNewGame=true;
		dropBlockers.Clear();
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]OnRegister [1 - isNewGame]:\c- : %d", isNewGame);
 
		for (int i = 0; i < MAXPLAYERS; i++)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]OnRegister [2 - playerNeedsRestore to false]\c-: i: %d", i);
			playerNeedsRestore[i] = false;
		}
	}

	//If any world has loaded, then we're done handling new games case
	override void WorldLoaded(WorldEvent e) 
	{
		if (gameinfo.gametype & GAME_Raven)
		{
			for (let i = 0, l = level.Sectors.Size(); i < l; i++)
			{
				if (dydudebug_worldloaded) Console.Printf("    \czFireFloorAdjuster\c-: %d / %d", i, l);
				if (level.Sectors[i].damagetype == 'Fire' || level.Sectors[i].damagetype == 'Lava')
						level.Sectors[i].damagetype = 'Magma';
			}
		}
		
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- WorldLoaded() activated");
		// This will be done only by the first player entering
		// Restoring undroppable and untossable stats for all inventory items !
		// VERY IMPORTANT to keep the intended behaviour of all items/weapons/...
		RestoreItemsState();

		// Once we're done loading a level, regardless of what happened beforehand,
		// this is not a new game anymore ! Also we're done restoring anything, so clear arrays
		isNewGame = false;
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]WorldLoaded [2 - isNewGame to false]\c-: %d", isNewGame);

		// World is loaded, everything is done, no players to restore, safe cleanup in prevision of next level
		for (int i = 0; i < MAXPLAYERS; i++)
		{
			playerNeedsRestore[i] = false;
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]WorldLoaded [3 - playerNeedsRestore to false]\c-: i: %d", i);
		}
	}
	
	override void WorldUnloaded(WorldEvent e)
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- WorldUnloaded() activated");
		// World is unloaded from save, we don't restore inventory, and this is not a new game
		if (e.IsSaveGame)
		{
			isNewGame = false;
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]WorldUnLoaded [2a - IsSaveGame to false]\c-: %d", isNewGame);
			
			// Try to reset the resurrection queue on a save reload (after dying) to circumvent a major issue with the base Universal Keeper mod. - Misfit
			for (int i = 0; i < MAXPLAYERS; i++) 
			{
				if (dydudebug_resetinventorydebug) Console.Printf("\c[green]WorldUnLoaded (clear resurrect queue) [3 - player#]\c-: %d", i);
				ResetResurrectionQueue(i);
			}
		}
		/* This is a new game, all future world loads are level exits except for saves (above)
		 and new games (in which case isNewGame will be true again) */
		else if (!isNewGame) 
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]WorldUnLoaded [2b - !isNewGame]\c-");
			/* We manually remove all weapons and give back a default inventory
			   Later on we give back the correct amount of said inventory, as some mods'
			   default inventories may include inventory item that will get stacked here */
			ManageWeapons();

			/* Key Checking - Misfit Added :V */
			ManageKeys();
			
			/* Manage Health - Misfit Added :V */
			ManageHealth();

			// We make all inventory undroppable so ResetInventory can't do its job
			MakeInventoryUndroppable();

			/* We resurrect dead players no matter what (EVEN if we did get here from
			   a new game or savegame the player entity would be replaced by a new one
			   after the load ! */
			ResurrectPlayers();
			BackupInventories();
		}
	}

	override void PlayerEntered(PlayerEvent e)
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- PlayerEntered() activated");
		RestorePlayerInvState(e.playerNumber);
	}

	override void PlayerRespawned(PlayerEvent e)
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- PlayerRespawned() activated");
		ResetResurrectionQueue(e.playerNumber);
	}

	override void PlayerDied(PlayerEvent e)
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- PlayerDied() activated");
		if (playeringame[e.playerNumber] && players[e.playerNumber].mo != null)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]PlayerDied [2 - playersToResurrect]\c: %d", e.playerNumber);
			playersToResurrect.Push(e.playerNumber);
		}
	}
	
	override void NewGame()
	{
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]ResetInventory:\c- NewGame() activated");
		isNewGame = true;
		dropBlockers.Clear();
		if (dydudebug_resetinventorydebug) Console.Printf("\c[green]NewGame [2 - isNewGame]\c-: %d", isNewGame);

		for (int i = 0; i < MAXPLAYERS; i++)
		{
			if (dydudebug_resetinventorydebug) Console.Printf("\c[green]NewGame [3 - playerNeedsRestore]\c-: i: %d", i);
			playerNeedsRestore[i] = false;
		}
	}
}